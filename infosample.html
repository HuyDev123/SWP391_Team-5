<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thêm Mẫu Xét Nghiệm Mới - Kit Sample</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #4caf50, #388e3c);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header h1 i {
        margin-right: 15px;
        font-size: 36px;
      }

      .header p {
        font-size: 16px;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .sample-info-form {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .form-section {
        margin-bottom: 40px;
      }

      .section-title {
        font-size: 20px;
        color: #4caf50;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 3px solid #e8f5e8;
        display: flex;
        align-items: center;
      }

      .section-title i {
        margin-right: 12px;
        background-color: #4caf50;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .form-row {
        display: flex;
        margin-bottom: 20px;
        align-items: center;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }

      .form-row:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .form-label {
        flex: 0 0 220px;
        font-weight: bold;
        color: #333;
        margin-right: 20px;
      }

      .form-value {
        flex: 1;
      }

      .form-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        color: #495057;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
      }

      .form-input.sample-code {
        background: linear-gradient(45deg, #e8f5e8, #c8e6c9);
        border-color: #4caf50;
        color: #2e7d32;
        font-weight: bold;
        font-size: 18px;
        text-align: center;
        cursor: not-allowed;
      }

      .form-input.sample-code-input {
        background: linear-gradient(45deg, #fff3e0, #ffcc80);
        border-color: #ff9800;
        color: #f57c00;
        font-weight: bold;
        font-size: 18px;
        text-align: center;
      }

      .form-input.sample-code-input:focus {
        outline: none;
        border-color: #ff9800;
        box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);
      }

      .form-input.kit-code {
        background: linear-gradient(45deg, #f3e5f5, #ce93d8);
        border-color: #9c27b0;
        color: #7b1fa2;
        font-weight: bold;
        font-size: 16px;
        text-align: center;
        cursor: not-allowed;
      }

      .form-select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        color: #495057;
        font-size: 15px;
        background-color: white;
        transition: all 0.3s ease;
      }

      .form-select:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
      }

      .form-textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        color: #495057;
        font-size: 15px;
        resize: vertical;
        min-height: 100px;
        font-family: Arial, sans-serif;
        transition: all 0.3s ease;
      }

      .form-textarea:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
      }

      .divider {
        border: none;
        border-top: 2px dashed #dee2e6;
        margin: 30px 0;
      }

      .action-section {
        background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        padding: 25px;
        border-radius: 10px;
        text-align: center;
      }

      .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.3s ease;
        min-width: 180px;
        justify-content: center;
      }

      .btn i {
        margin-right: 10px;
        font-size: 18px;
      }

      .btn-success {
        background: linear-gradient(45deg, #4caf50, #388e3c);
        color: white;
      }

      .btn-success:hover {
        background: linear-gradient(45deg, #388e3c, #2e7d32);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
      }

      .btn-secondary {
        background: linear-gradient(45deg, #6c757d, #545b62);
        color: white;
      }

      .btn-secondary:hover {
        background: linear-gradient(45deg, #545b62, #3d4146);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
      }

      /* Required field indicator */
      .required::after {
        content: "*";
        color: #f44336;
        margin-left: 5px;
      }

      /* Validation styles */
      .form-input.error {
        border-color: #f44336;
        box-shadow: 0 0 10px rgba(244, 67, 54, 0.2);
      }

      .error-message {
        color: #f44336;
        font-size: 12px;
        margin-top: 5px;
        display: none;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 10px;
        }

        .content {
          padding: 20px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 24px;
        }

        .form-row {
          flex-direction: column;
          align-items: flex-start;
        }

        .form-label {
          flex: none;
          margin-bottom: 10px;
          margin-right: 0;
        }

        .form-value {
          width: 100%;
        }

        .action-buttons {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }

      /* Animation */
      .fade-in {
        animation: fadeIn 0.8s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Success indicator */
      .success-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #4caf50, #66bb6a);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        z-index: 1000;
        display: none;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
  </head>
  <body>
    <div class="container fade-in">
      <!-- Header -->
      <div class="header">
        <h1>
          <i class="fas fa-plus-circle"></i>
          Thêm Mẫu Xét Nghiệm Mới
        </h1>
        <p>Điền thông tin chi tiết cho mẫu xét nghiệm ADN huyết thống mới</p>
      </div>

      <!-- Content -->
      <div class="content">
        <form id="addSampleForm" class="sample-info-form">
          <!-- Thông tin mẫu -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-barcode"></i>
              Thông Tin Mẫu
            </h3>

            <div class="form-row">
              <label class="form-label required">Mã mẫu:</label>
              <div class="form-value">
                <input
                  type="text"
                  class="form-input sample-code-input"
                  id="sample-code"
                  placeholder="Nhập mã mẫu (VD: SM-2025001)"
                  required
                />
                <div class="error-message">Vui lòng nhập mã mẫu hợp lệ</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label">Mã kit liên kết:</label>
              <div class="form-value">
                <input
                  type="text"
                  class="form-input kit-code"
                  id="kit-code"
                  value="KIT-2025001"
                  readonly
                />
              </div>
            </div>
          </div>

          <hr class="divider" />

          <!-- Thông tin cá nhân -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-user"></i>
              Thông Tin Cá Nhân
            </h3>

            <div class="form-row">
              <label class="form-label required">Họ tên đầy đủ:</label>
              <div class="form-value">
                <input
                  type="text"
                  class="form-input"
                  id="full-name"
                  placeholder="Nhập họ tên đầy đủ"
                  required
                />
                <div class="error-message">Vui lòng nhập họ tên đầy đủ</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label required">Ngày sinh:</label>
              <div class="form-value">
                <input
                  type="date"
                  class="form-input"
                  id="birth-date"
                  required
                />
                <div class="error-message">Vui lòng chọn ngày sinh</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label required">Giới tính:</label>
              <div class="form-value">
                <select class="form-select" id="gender" required>
                  <option value="">-- Chọn giới tính --</option>
                  <option value="Nam">Nam</option>
                  <option value="Nữ">Nữ</option>
                  <option value="Khác">Khác</option>
                </select>
                <div class="error-message">Vui lòng chọn giới tính</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label">Mối quan hệ trong mẫu:</label>
              <div class="form-value">
                <select class="form-select" id="relationship">
                  <option value="">-- Chọn mối quan hệ --</option>
                  <option value="Cha">Cha</option>
                  <option value="Mẹ">Mẹ</option>
                  <option value="Con trai">Con trai</option>
                  <option value="Con gái">Con gái</option>
                  <option value="Anh trai">Anh trai</option>
                  <option value="Em trai">Em trai</option>
                  <option value="Chị gái">Chị gái</option>
                  <option value="Em gái">Em gái</option>
                  <option value="Khác">Khác</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label required">Số điện thoại:</label>
              <div class="form-value">
                <input
                  type="tel"
                  class="form-input"
                  id="phone"
                  placeholder="Nhập số điện thoại (10-11 chữ số)"
                  pattern="[0-9]{10,11}"
                  required
                />
                <div class="error-message">
                  Vui lòng nhập số điện thoại hợp lệ (10-11 chữ số)
                </div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label required">Địa chỉ:</label>
              <div class="form-value">
                <textarea
                  class="form-textarea"
                  id="address"
                  placeholder="Nhập địa chỉ chi tiết"
                  required
                ></textarea>
                <div class="error-message">Vui lòng nhập địa chỉ</div>
              </div>
            </div>
          </div>

          <hr class="divider" />

          <!-- Thông tin thu mẫu -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-calendar-check"></i>
              Thông Tin Thu Mẫu
            </h3>

            <div class="form-row">
              <label class="form-label required">Tên người thu mẫu:</label>
              <div class="form-value">
                <input
                  type="text"
                  class="form-input"
                  id="collector-name"
                  placeholder="Nhập tên người thu mẫu"
                  required
                />
                <div class="error-message">Vui lòng nhập tên người thu mẫu</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label required">Ngày lấy mẫu:</label>
              <div class="form-value">
                <input
                  type="date"
                  class="form-input"
                  id="collection-date"
                  required
                />
                <div class="error-message">Vui lòng chọn ngày lấy mẫu</div>
              </div>
            </div>

            <div class="form-row">
              <label class="form-label">Ghi chú:</label>
              <div class="form-value">
                <textarea
                  class="form-textarea"
                  id="notes"
                  placeholder="Nhập ghi chú (nếu có)"
                ></textarea>
              </div>
            </div>
          </div>
        </form>

        <!-- Action Section -->
        <div class="action-section">
          <div class="action-buttons">
            <button type="reset" class="btn btn-secondary">
              <i class="fas fa-undo"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-success" onclick="addSample()">
              <i class="fas fa-plus"></i>
              Lưu Mẫu
            </button>
          </div>
        </div>

        <div id="sample-form-container"></div>
      </div>
    </div>

    <!-- Success Indicator -->
    <div class="success-indicator" id="successIndicator">
      <i class="fas fa-check"></i> Đã thêm mẫu thành công!
    </div>

    <script>
      // Load ngày hiện tại cho collection-date
      document.addEventListener("DOMContentLoaded", function () {
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("collection-date").value = today;

        // Load kit code mặc định từ database
        loadDefaultKitCode();
      });

      // Tạo mã mẫu và kit tự động
      function generateSampleCode() {
        const currentYear = new Date().getFullYear();
        const randomNumber = Math.floor(Math.random() * 1000)
          .toString()
          .padStart(3, "0");

        const sampleCode = `SM-${currentYear}${randomNumber}`;
        const kitCode = `KIT-${currentYear}${randomNumber}`;

        document.getElementById("sample-code").value = sampleCode;
        document.getElementById("kit-code").value = kitCode;
      }

      // Validation form
      function validateForm() {
        const requiredFields = document.querySelectorAll(
          "input[required], select[required], textarea[required]"
        );
        let isValid = true;

        requiredFields.forEach((field) => {
          const errorMsg = field.parentNode.querySelector(".error-message");

          if (!field.value.trim()) {
            field.classList.add("error");
            errorMsg.style.display = "block";
            isValid = false;
          } else {
            field.classList.remove("error");
            errorMsg.style.display = "none";
          }
        });

        // Validate phone number
        const phone = document.getElementById("phone");
        if (phone.value && !/^\d{10,11}$/.test(phone.value)) {
          phone.classList.add("error");
          phone.parentNode.querySelector(".error-message").style.display =
            "block";
          isValid = false;
        }

        // Validate birth date (không được lớn hơn ngày hiện tại)
        const birthDate = document.getElementById("birth-date");
        if (birthDate.value && new Date(birthDate.value) > new Date()) {
          birthDate.classList.add("error");
          birthDate.parentNode.querySelector(".error-message").textContent =
            "Ngày sinh không được lớn hơn ngày hiện tại";
          birthDate.parentNode.querySelector(".error-message").style.display =
            "block";
          isValid = false;
        }

        // Validate collection date (không được lớn hơn ngày hiện tại)
        const collectionDate = document.getElementById("collection-date");
        if (
          collectionDate.value &&
          new Date(collectionDate.value) > new Date()
        ) {
          collectionDate.classList.add("error");
          collectionDate.parentNode.querySelector(
            ".error-message"
          ).textContent = "Ngày lấy mẫu không được lớn hơn ngày hiện tại";
          collectionDate.parentNode.querySelector(
            ".error-message"
          ).style.display = "block";
          isValid = false;
        }

        return isValid;
      }

      //   // Quay lại trang trước
      //   function goBack() {
      //     if (
      //       confirm(
      //         "Bạn có chắc chắn muốn quay lại? Thông tin đã nhập sẽ bị mất."
      //       )
      //     ) {
      //       window.history.back();
      //     }
      //   }

      // Thêm mẫu mới
      function addSample() {
        if (!validateForm()) {
          showAlert(
            "Vui lòng kiểm tra và điền đầy đủ thông tin bắt buộc!",
            "error"
          );
          return;
        }

        const formData = {
          sampleCode: document.getElementById("sample-code").value,
          kitCode: document.getElementById("kit-code").value,
          fullName: document.getElementById("full-name").value,
          birthDate: document.getElementById("birth-date").value,
          gender: document.getElementById("gender").value,
          relationship: document.getElementById("relationship").value,
          phone: document.getElementById("phone").value,
          address: document.getElementById("address").value,
          collectorName: document.getElementById("collector-name").value,
          collectionDate: document.getElementById("collection-date").value,
          notes: document.getElementById("notes").value,
        };

        // Giả lập API call
        setTimeout(() => {
          showSuccessIndicator();
          showAlert("Đã thêm mẫu thành công!", "success");

          // Reset form sau khi thêm thành công
          setTimeout(() => {
            if (confirm("Bạn có muốn thêm mẫu khác không?")) {
              resetForm();
            } else {
              window.location.href = "sample-list.html"; // Chuyển về danh sách
            }
          }, 2000);
        }, 1000);
      }

      // Reset form
      function resetForm() {
        document.getElementById("addSampleForm").reset();

        // Ẩn tất cả error messages
        const errorMsgs = document.querySelectorAll(".error-message");
        errorMsgs.forEach((msg) => {
          msg.style.display = "none";
        });

        // Remove error classes
        const errorFields = document.querySelectorAll(
          ".form-input.error, .form-select.error, .form-textarea.error"
        );
        errorFields.forEach((field) => {
          field.classList.remove("error");
        });

        // Set lại ngày hiện tại
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("collection-date").value = today;

        // Tạo mã mới
        generateSampleCode();
      }

      // Hiển thị success indicator
      function showSuccessIndicator() {
        const indicator = document.getElementById("successIndicator");
        indicator.style.display = "block";
        setTimeout(() => {
          indicator.style.display = "none";
        }, 2000);
      }

      // Hàm hiển thị thông báo
      function showAlert(message, type) {
        const alertDiv = document.createElement("div");
        alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;

        switch (type) {
          case "success":
            alertDiv.style.background =
              "linear-gradient(45deg, #4caf50, #66bb6a)";
            break;
          case "info":
            alertDiv.style.background =
              "linear-gradient(45deg, #2196f3, #42a5f5)";
            break;
          case "error":
            alertDiv.style.background =
              "linear-gradient(45deg, #f44336, #ef5350)";
            break;
        }

        alertDiv.textContent = message;
        document.body.appendChild(alertDiv);

        setTimeout(() => {
          alertDiv.remove();
        }, 3000);
      }

      // ...existing code...

      const urlParams = new URLSearchParams(window.location.search);
      const kitCode = urlParams.get("kitCode") || "";
      const sampleCount = parseInt(urlParams.get("sampleCount")) || 1;

      const formContainer = document.getElementById("sample-form-container");
      if (sampleCount > 1) {
        for (let i = 2; i <= sampleCount; i++) {
          formContainer.innerHTML += `
      <form class="sample-info-form" id="sampleForm${i}" style="margin-bottom: 30px; background: #f8f9fa; border-radius: 10px; padding: 30px;">
        <!-- Thông tin mẫu -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-barcode"></i>
            Thông Tin Mẫu #${i}
          </h3>
          <div class="form-row">
            <label class="form-label required">Mã mẫu:</label>
            <div class="form-value">
              <input type="text" class="form-input sample-code-input" id="sample-code${i}" placeholder="Nhập mã mẫu (VD: SM-202500${i})" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label">Mã kit liên kết:</label>
            <div class="form-value">
              <input type="text" class="form-input kit-code" id="kit-code${i}" value="${kitCode}" readonly />
            </div>
          </div>
        </div>
        <hr class="divider" />

        <!-- Thông tin cá nhân -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-user"></i>
            Thông Tin Cá Nhân
          </h3>
          <div class="form-row">
            <label class="form-label required">Họ tên đầy đủ:</label>
            <div class="form-value">
              <input type="text" class="form-input" id="full-name${i}" placeholder="Nhập họ tên đầy đủ" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label required">Ngày sinh:</label>
            <div class="form-value">
              <input type="date" class="form-input" id="birth-date${i}" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label required">Giới tính:</label>
            <div class="form-value">
              <select class="form-select" id="gender${i}" required>
                <option value="">-- Chọn giới tính --</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
                <option value="Khác">Khác</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <label class="form-label">Mối quan hệ trong mẫu:</label>
            <div class="form-value">
              <select class="form-select" id="relationship${i}">
                <option value="">-- Chọn mối quan hệ --</option>
                <option value="Cha">Cha</option>
                <option value="Mẹ">Mẹ</option>
                <option value="Con trai">Con trai</option>
                <option value="Con gái">Con gái</option>
                <option value="Anh trai">Anh trai</option>
                <option value="Em trai">Em trai</option>
                <option value="Chị gái">Chị gái</option>
                <option value="Em gái">Em gái</option>
                <option value="Khác">Khác</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <label class="form-label required">Số điện thoại:</label>
            <div class="form-value">
              <input type="tel" class="form-input" id="phone${i}" placeholder="Nhập số điện thoại (10-11 chữ số)" pattern="[0-9]{10,11}" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label required">Địa chỉ:</label>
            <div class="form-value">
              <textarea class="form-textarea" id="address${i}" placeholder="Nhập địa chỉ chi tiết" required></textarea>
            </div>
          </div>
        </div>
        <hr class="divider" />

        <!-- Thông tin thu mẫu -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-calendar-check"></i>
            Thông Tin Thu Mẫu
          </h3>
          <div class="form-row">
            <label class="form-label required">Tên người thu mẫu:</label>
            <div class="form-value">
              <input type="text" class="form-input" id="collector-name${i}" placeholder="Nhập tên người thu mẫu" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label required">Ngày lấy mẫu:</label>
            <div class="form-value">
              <input type="date" class="form-input" id="collection-date${i}" required />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label">Ghi chú:</label>
            <div class="form-value">
              <textarea class="form-textarea" id="notes${i}" placeholder="Nhập ghi chú (nếu có)"></textarea>
            </div>
          </div>
        </div>
        <div class="action-section">
          <div class="action-buttons">
            <button type="button" class="btn btn-secondary" onclick="resetSampleForm(${i})">
              <i class="fas fa-undo"></i> Reset
            </button>
            <button type="button" class="btn btn-success" onclick="saveSample(${i})">
              <i class="fas fa-save"></i> Lưu mẫu #${i}
            </button>
          </div>
        </div>
      </form>
    `;
        }
      }

      document.getElementById("addSampleForm").onsubmit = function (e) {
        e.preventDefault();
        const samples = [];
        for (let i = 1; i <= sampleCount; i++) {
          samples.push({
            sampleCode: this[`sampleCode${i}`].value,
            kitCode: kitCode,
            fullName: this[`fullName${i}`].value,
            birthDate: this[`birthDate${i}`].value,
            gender: this[`gender${i}`].value,
            relationship: this[`relationship${i}`].value,
            phone: this[`phone${i}`].value,
            address: this[`address${i}`].value,
            collectorName: this[`collectorName${i}`].value,
            collectionDate: this[`collectionDate${i}`].value,
            notes: this[`notes${i}`].value,
          });
        }
        // Gửi samples lên API hoặc xử lý tiếp
        alert(JSON.stringify(samples, null, 2));
        // ...API call hoặc xử lý tiếp...
      };

      // Hàm lưu riêng từng mẫu
      function saveSample(i) {
        const sample = {
          sampleCode: document.getElementById(`sampleCode${i}`).value,
          kitCode: document.getElementById(`kitCode${i}`).value,
          fullName: document.getElementById(`fullName${i}`).value,
          birthDate: document.getElementById(`birthDate${i}`).value,
          gender: document.getElementById(`gender${i}`).value,
          relationship: document.getElementById(`relationship${i}`).value,
          phone: document.getElementById(`phone${i}`).value,
          address: document.getElementById(`address${i}`).value,
          collectorName: document.getElementById(`collectorName${i}`).value,
          collectionDate: document.getElementById(`collectionDate${i}`).value,
          notes: document.getElementById(`notes${i}`).value,
        };
        // TODO: Validate và gửi dữ liệu mẫu này lên API
        alert("Lưu mẫu #" + i + ":\n" + JSON.stringify(sample, null, 2));
      }

      // Reset thông tin mẫu riêng lẻ (cho từng mẫu phụ)
      function resetSampleForm(i) {
        // Lấy tất cả input, select, textarea trong form mẫu phụ thứ i
        const fields = [
          `sample-code${i}`,
          `kit-code${i}`,
          `full-name${i}`,
          `birth-date${i}`,
          `gender${i}`,
          `relationship${i}`,
          `phone${i}`,
          `address${i}`,
          `collector-name${i}`,
          `collection-date${i}`,
          `notes${i}`,
        ];
        fields.forEach((id) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (el.tagName === "SELECT") el.selectedIndex = 0;
          else if (
            el.type === "date" ||
            el.type === "text" ||
            el.type === "tel"
          )
            el.value = "";
          else if (el.tagName === "TEXTAREA") el.value = "";
          // Nếu là kit-code thì giữ nguyên readonly value
          if (id.startsWith("kit-code"))
            el.value = document.getElementById("kit-code").value;
        });
      }
    </script>
  </body>
</html>
