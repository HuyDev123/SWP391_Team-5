<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản Lý Kit Xét Nghiệm - Dịch Vụ Xét Nghiệm ADN</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="stylesheet" href="/assets/css/staff-auth.css" />
    <link rel="stylesheet" href="/assets/css/staff-style.css" />
    <link rel="stylesheet" href="/assets/css/staff-modal.css" />
    <style>
      body {
        display: flex;
        min-height: 100vh;
        background-color: #f5f5f5;
      }

      .text-container {
        display: flex;
        flex-direction: column;
      }

      .avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      }

      #user-avatar {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      .logout-btn {
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
      }

      .logout-btn:hover {
        background: linear-gradient(135deg, #d32f2f, #c62828);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
      }
      .logout-btn i {
        font-size: 14px;
      }

      .btn-google {
        background: linear-gradient(135deg, #4285f4, #3367d6);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        box-shadow: 0 2px 8px rgba(66, 133, 244, 0.3);
      }

      .btn-google:hover {
        background: linear-gradient(135deg, #3367d6, #2851a3);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4);
      }

      .btn-google i {
        font-size: 16px;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }

      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }

      #mainMenu {
        padding: 10px 15px;
      }

      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }

      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(33, 150, 243, 0.1),
          transparent
        );
        transition: left 0.6s ease;
      }

      .menu-item:hover::before {
        left: 100%;
      }

      .menu-item:hover {
        background: linear-gradient(
          135deg,
          rgba(33, 150, 243, 0.1),
          rgba(33, 150, 243, 0.05)
        );
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }

      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(
          135deg,
          rgba(33, 150, 243, 0.15),
          rgba(33, 150, 243, 0.08)
        );
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }

      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.3),
          transparent 70%
        );
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0.7)
        );
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.1)
        );
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      .navbar {
        display: flex;
        margin: 20px 0;
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        padding: 15px 20px;
        text-decoration: none;
        color: #333;
        display: flex;
        align-items: center;
        border-bottom: 2px solid transparent;
      }

      .nav-item.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .nav-icon {
        margin-right: 10px;
      }

      /* Sample collection styles */
      .sample-header {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("/assets/images/banner.jpg");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 60px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
      }

      .sample-header h1 {
        font-size: 32px;
        margin-bottom: 15px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }

      .sample-header p {
        font-size: 18px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .instruction-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .instruction-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .warning-box {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 5px 5px 0;
      }

      .warning-title {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e65100;
      }

      .warning-icon {
        margin-right: 10px;
        font-size: 20px;
      }

      .steps-container {
        margin-top: 30px;
      }

      .step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
      }

      .step-number {
        width: 50px;
        height: 50px;
        background-color: #2196f3;
        color: white;
        font-size: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 20px;
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
      }

      .step-description {
        color: #555;
        line-height: 1.6;
      }

      .step-image {
        width: 100%;
        max-width: 300px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-timeline {
        position: absolute;
        left: 24px;
        top: 50px;
        bottom: -30px;
        width: 2px;
        background-color: #2196f3;
      }

      .step:last-child .step-timeline {
        display: none;
      }

      .step-tip {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-tip-title {
        font-weight: bold;
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        color: #0d47a1;
      }

      .step-tip-icon {
        margin-right: 8px;
      }

      .step-bullet-list {
        margin-top: 15px;
        margin-left: 5px;
        list-style-type: none;
      }

      .step-bullet-list li {
        position: relative;
        padding-left: 28px;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .step-bullet-list li:before {
        content: "•";
        position: absolute;
        left: 0;
        top: 0;
        color: #2196f3;
        font-size: 24px;
        line-height: 1;
      }

      .step-image-container {
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .step-image-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .step-image {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 8px;
      }

      .step-content {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .step-text {
        flex: 1;
        min-width: 300px;
      }

      .step-visual {
        flex: 1;
        min-width: 300px;
        padding-left: 20px;
        display: flex;
        justify-content: center;
      }
      .sample-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .sample-type {
        flex: 1;
        min-width: 250px;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
      }
      .sample-type:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .step-content {
          flex-direction: column;
        }

        .step-visual {
          padding-left: 0;
          margin-top: 20px;
          width: 100%;
        }
      }
      .sample-type-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: center;
      }

      .sample-type-icon {
        margin-right: 10px;
        color: #2196f3;
        font-size: 20px;
      }

      .sample-type-content {
        color: #555;
        line-height: 1.5;
      }

      /* Video section */
      .video-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .video-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
      }

      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* FAQs section */
      .faq-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .faq-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .faq-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .faq-question {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: flex-start;
      }

      .question-icon {
        color: #2196f3;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .faq-answer {
        color: #555;
        line-height: 1.6;
        padding-left: 30px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .step {
          flex-direction: column;
        }

        .step-number {
          margin-bottom: 15px;
          margin-right: 0;
        }

        .step-timeline {
          display: none;
        }
      }
      .highlighted-step {
        animation: highlight-step 3s ease;
      }

      @keyframes highlight-step {
        0%,
        100% {
          background-color: transparent;
        }
        20%,
        80% {
          background-color: rgba(33, 150, 243, 0.1);
          box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
          transform: translateY(-5px);
        }
      }

      /* Đảm bảo các bước có đủ padding cho hiệu ứng */
      .step {
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }
      .menu-icon i {
        font-size: 18px;
        width: 20px;
        text-align: center;
      } /* Menu styles */
      #mainMenu {
        padding: 10px;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #2196f3;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1976d2;
      }

      /* Modal animation */
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Modal responsive styles */
      /* @media (max-width: 768px) {
        #kit-modal-content {
          width: 95%;
          margin: 10px;
        }

        #kit-modal-iframe {
          height: 85vh;
        }
      } */

      /* Custom scrollbar for modal */
      /* #kit-modal-overlay::-webkit-scrollbar {
        width: 8px;
      }

      #kit-modal-overlay::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb {
        background: rgba(33, 150, 243, 0.5);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb:hover {
        background: rgba(33, 150, 243, 0.7);
      } */

      /* Ẩn nút tăng/giảm ở input type=number cho mọi trình duyệt */
      /* #kit-appointment-id::-webkit-outer-spin-button,
      #kit-appointment-id::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      #kit-appointment-id[type="number"] {
        -moz-appearance: textfield;
        appearance: textfield;
      } */

      /* Override với specificity cao hơn */
      body #kitFilterForm {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 14px !important;
        align-items: flex-end !important;
        width: 100% !important;
        justify-content: stretch !important;
      }

      body #kitFilterForm > div {
        margin: 0 !important;
      }

      body #kitFilterForm input,
      body #kitFilterForm select {
        margin: 0 !important;
        padding: 10px 12px !important;
        border: 1px solid #ddd !important;
        border-radius: 6px !important;
        outline: none !important;
        background: #fff !important;
      }

      body #kitFilterForm button {
        margin: 0 !important;
        padding: 10px 18px !important;
        border: none !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        white-space: nowrap !important;
        min-width: 44px !important;
      }

      body #kitFilterForm button[type="submit"] {
        background: #2196f3 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.08) !important;
      }

      body #kitFilterForm button[type="reset"] {
        background: #f44336 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08) !important;
        min-width: 90px !important;
      }

      .login-register {
        padding: 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(245, 245, 245, 0.6));
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        margin: 15px;
        margin-bottom: 20px; /* Đồng bộ với staff-index.html */
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }
      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 20px 0 20px;
      }
      .text-container {
        display: flex;
        flex-direction: column;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }
      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }
      #mainMenu {
        padding: 10px 15px;
      }
      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }
      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.1), transparent);
        transition: left 0.6s ease;
      }
      .menu-item:hover::before {
        left: 100%;
      }
      .menu-item:hover {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }
      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
      }
      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(33, 150, 243, 0.08));
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }
      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      .navbar {
        display: flex;
        margin: 20px 0;
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        padding: 15px 20px;
        text-decoration: none;
        color: #333;
        display: flex;
        align-items: center;
        border-bottom: 2px solid transparent;
      }

      .nav-item.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .nav-icon {
        margin-right: 10px;
      }

      /* Sample collection styles */
      .sample-header {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("/assets/images/banner.jpg");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 60px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
      }

      .sample-header h1 {
        font-size: 32px;
        margin-bottom: 15px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }

      .sample-header p {
        font-size: 18px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .instruction-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .instruction-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .warning-box {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 5px 5px 0;
      }

      .warning-title {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e65100;
      }

      .warning-icon {
        margin-right: 10px;
        font-size: 20px;
      }

      .steps-container {
        margin-top: 30px;
      }

      .step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
      }

      .step-number {
        width: 50px;
        height: 50px;
        background-color: #2196f3;
        color: white;
        font-size: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 20px;
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
      }

      .step-description {
        color: #555;
        line-height: 1.6;
      }

      .step-image {
        width: 100%;
        max-width: 300px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-timeline {
        position: absolute;
        left: 24px;
        top: 50px;
        bottom: -30px;
        width: 2px;
        background-color: #2196f3;
      }

      .step:last-child .step-timeline {
        display: none;
      }

      .step-tip {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-tip-title {
        font-weight: bold;
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        color: #0d47a1;
      }

      .step-tip-icon {
        margin-right: 8px;
      }

      .step-bullet-list {
        margin-top: 15px;
        margin-left: 5px;
        list-style-type: none;
      }

      .step-bullet-list li {
        position: relative;
        padding-left: 28px;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .step-bullet-list li:before {
        content: "•";
        position: absolute;
        left: 0;
        top: 0;
        color: #2196f3;
        font-size: 24px;
        line-height: 1;
      }

      .step-image-container {
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .step-image-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .step-image {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 8px;
      }

      .step-content {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .step-text {
        flex: 1;
        min-width: 300px;
      }

      .step-visual {
        flex: 1;
        min-width: 300px;
        padding-left: 20px;
        display: flex;
        justify-content: center;
      }
      .sample-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .sample-type {
        flex: 1;
        min-width: 250px;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
      }
      .sample-type:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .step-content {
          flex-direction: column;
        }

        .step-visual {
          padding-left: 0;
          margin-top: 20px;
          width: 100%;
        }
      }
      .sample-type-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: center;
      }

      .sample-type-icon {
        margin-right: 10px;
        color: #2196f3;
        font-size: 20px;
      }

      .sample-type-content {
        color: #555;
        line-height: 1.5;
      }

      /* Video section */
      .video-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .video-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
      }

      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* FAQs section */
      .faq-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .faq-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .faq-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .faq-question {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: flex-start;
      }

      .question-icon {
        color: #2196f3;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .faq-answer {
        color: #555;
        line-height: 1.6;
        padding-left: 30px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .step {
          flex-direction: column;
        }

        .step-number {
          margin-bottom: 15px;
          margin-right: 0;
        }

        .step-timeline {
          display: none;
        }
      }
      .highlighted-step {
        animation: highlight-step 3s ease;
      }

      @keyframes highlight-step {
        0%,
        100% {
          background-color: transparent;
        }
        20%,
        80% {
          background-color: rgba(33, 150, 243, 0.1);
          box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
          transform: translateY(-5px);
        }
      }

      /* Đảm bảo các bước có đủ padding cho hiệu ứng */
      .step {
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }
      .menu-icon i {
        font-size: 18px;
        width: 20px;
        text-align: center;
      } /* Menu styles */
      #mainMenu {
        padding: 10px;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #2196f3;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1976d2;
      }

      /* Modal animation */
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Modal responsive styles */
      /* @media (max-width: 768px) {
        #kit-modal-content {
          width: 95%;
          margin: 10px;
        }

        #kit-modal-iframe {
          height: 85vh;
        }
      } */

      /* Custom scrollbar for modal */
      /* #kit-modal-overlay::-webkit-scrollbar {
        width: 8px;
      }

      #kit-modal-overlay::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb {
        background: rgba(33, 150, 243, 0.5);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb:hover {
        background: rgba(33, 150, 243, 0.7);
      } */

      /* Ẩn nút tăng/giảm ở input type=number cho mọi trình duyệt */
      /* #kit-appointment-id::-webkit-outer-spin-button,
      #kit-appointment-id::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      #kit-appointment-id[type="number"] {
        -moz-appearance: textfield;
        appearance: textfield;
      } */

      /* Override với specificity cao hơn */
      body #kitFilterForm {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 14px !important;
        align-items: flex-end !important;
        width: 100% !important;
        justify-content: stretch !important;
      }

      body #kitFilterForm > div {
        margin: 0 !important;
      }

      body #kitFilterForm input,
      body #kitFilterForm select {
        margin: 0 !important;
        padding: 10px 12px !important;
        border: 1px solid #ddd !important;
        border-radius: 6px !important;
        outline: none !important;
        background: #fff !important;
      }

      body #kitFilterForm button {
        margin: 0 !important;
        padding: 10px 18px !important;
        border: none !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        white-space: nowrap !important;
        min-width: 44px !important;
      }

      body #kitFilterForm button[type="submit"] {
        background: #2196f3 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.08) !important;
      }

      body #kitFilterForm button[type="reset"] {
        background: #f44336 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08) !important;
        min-width: 90px !important;
      }

      .login-register {
        padding: 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(245, 245, 245, 0.6));
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        margin: 15px;
        margin-bottom: 20px; /* Đồng bộ với staff-index.html */
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }
      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 20px 0 20px;
      }
      .text-container {
        display: flex;
        flex-direction: column;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }
      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }
      #mainMenu {
        padding: 10px 15px;
      }
      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }
      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.1), transparent);
        transition: left 0.6s ease;
      }
      .menu-item:hover::before {
        left: 100%;
      }
      .menu-item:hover {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }
      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
      }
      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(33, 150, 243, 0.08));
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }
      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      .navbar {
        display: flex;
        margin: 20px 0;
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        padding: 15px 20px;
        text-decoration: none;
        color: #333;
        display: flex;
        align-items: center;
        border-bottom: 2px solid transparent;
      }

      .nav-item.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .nav-icon {
        margin-right: 10px;
      }

      /* Sample collection styles */
      .sample-header {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("/assets/images/banner.jpg");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 60px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
      }

      .sample-header h1 {
        font-size: 32px;
        margin-bottom: 15px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }

      .sample-header p {
        font-size: 18px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .instruction-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .instruction-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .warning-box {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 5px 5px 0;
      }

      .warning-title {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e65100;
      }

      .warning-icon {
        margin-right: 10px;
        font-size: 20px;
      }

      .steps-container {
        margin-top: 30px;
      }

      .step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
      }

      .step-number {
        width: 50px;
        height: 50px;
        background-color: #2196f3;
        color: white;
        font-size: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 20px;
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
      }

      .step-description {
        color: #555;
        line-height: 1.6;
      }

      .step-image {
        width: 100%;
        max-width: 300px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-timeline {
        position: absolute;
        left: 24px;
        top: 50px;
        bottom: -30px;
        width: 2px;
        background-color: #2196f3;
      }

      .step:last-child .step-timeline {
        display: none;
      }

      .step-tip {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-tip-title {
        font-weight: bold;
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        color: #0d47a1;
      }

      .step-tip-icon {
        margin-right: 8px;
      }

      .step-bullet-list {
        margin-top: 15px;
        margin-left: 5px;
        list-style-type: none;
      }

      .step-bullet-list li {
        position: relative;
        padding-left: 28px;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .step-bullet-list li:before {
        content: "•";
        position: absolute;
        left: 0;
        top: 0;
        color: #2196f3;
        font-size: 24px;
        line-height: 1;
      }

      .step-image-container {
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .step-image-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .step-image {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 8px;
      }

      .step-content {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .step-text {
        flex: 1;
        min-width: 300px;
      }

      .step-visual {
        flex: 1;
        min-width: 300px;
        padding-left: 20px;
        display: flex;
        justify-content: center;
      }
      .sample-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .sample-type {
        flex: 1;
        min-width: 250px;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
      }
      .sample-type:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .step-content {
          flex-direction: column;
        }

        .step-visual {
          padding-left: 0;
          margin-top: 20px;
          width: 100%;
        }
      }
      .sample-type-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: center;
      }

      .sample-type-icon {
        margin-right: 10px;
        color: #2196f3;
        font-size: 20px;
      }

      .sample-type-content {
        color: #555;
        line-height: 1.5;
      }

      /* Video section */
      .video-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .video-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
      }

      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* FAQs section */
      .faq-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .faq-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .faq-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .faq-question {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: flex-start;
      }

      .question-icon {
        color: #2196f3;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .faq-answer {
        color: #555;
        line-height: 1.6;
        padding-left: 30px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .step {
          flex-direction: column;
        }

        .step-number {
          margin-bottom: 15px;
          margin-right: 0;
        }

        .step-timeline {
          display: none;
        }
      }
      .highlighted-step {
        animation: highlight-step 3s ease;
      }

      @keyframes highlight-step {
        0%,
        100% {
          background-color: transparent;
        }
        20%,
        80% {
          background-color: rgba(33, 150, 243, 0.1);
          box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
          transform: translateY(-5px);
        }
      }

      /* Đảm bảo các bước có đủ padding cho hiệu ứng */
      .step {
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }
      .menu-icon i {
        font-size: 18px;
        width: 20px;
        text-align: center;
      } /* Menu styles */
      #mainMenu {
        padding: 10px;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #2196f3;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1976d2;
      }

      /* Modal animation */
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Modal responsive styles */
      /* @media (max-width: 768px) {
        #kit-modal-content {
          width: 95%;
          margin: 10px;
        }

        #kit-modal-iframe {
          height: 85vh;
        }
      } */

      /* Custom scrollbar for modal */
      /* #kit-modal-overlay::-webkit-scrollbar {
        width: 8px;
      }

      #kit-modal-overlay::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb {
        background: rgba(33, 150, 243, 0.5);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb:hover {
        background: rgba(33, 150, 243, 0.7);
      } */

      /* Ẩn nút tăng/giảm ở input type=number cho mọi trình duyệt */
      /* #kit-appointment-id::-webkit-outer-spin-button,
      #kit-appointment-id::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      #kit-appointment-id[type="number"] {
        -moz-appearance: textfield;
        appearance: textfield;
      } */

      /* Override với specificity cao hơn */
      body #kitFilterForm {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 14px !important;
        align-items: flex-end !important;
        width: 100% !important;
        justify-content: stretch !important;
      }

      body #kitFilterForm > div {
        margin: 0 !important;
      }

      body #kitFilterForm input,
      body #kitFilterForm select {
        margin: 0 !important;
        padding: 10px 12px !important;
        border: 1px solid #ddd !important;
        border-radius: 6px !important;
        outline: none !important;
        background: #fff !important;
      }

      body #kitFilterForm button {
        margin: 0 !important;
        padding: 10px 18px !important;
        border: none !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        white-space: nowrap !important;
        min-width: 44px !important;
      }

      body #kitFilterForm button[type="submit"] {
        background: #2196f3 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.08) !important;
      }

      body #kitFilterForm button[type="reset"] {
        background: #f44336 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08) !important;
        min-width: 90px !important;
      }

      .login-register {
        padding: 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(245, 245, 245, 0.6));
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        margin: 15px;
        margin-bottom: 20px; /* Đồng bộ với staff-index.html */
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }
      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 20px 0 20px;
      }
      .text-container {
        display: flex;
        flex-direction: column;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }
      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }
      #mainMenu {
        padding: 10px 15px;
      }
      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }
      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.1), transparent);
        transition: left 0.6s ease;
      }
      .menu-item:hover::before {
        left: 100%;
      }
      .menu-item:hover {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }
      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
      }
      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(33, 150, 243, 0.08));
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }
      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      .navbar {
        display: flex;
        margin: 20px 0;
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        padding: 15px 20px;
        text-decoration: none;
        color: #333;
        display: flex;
        align-items: center;
        border-bottom: 2px solid transparent;
      }

      .nav-item.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .nav-icon {
        margin-right: 10px;
      }

      /* Sample collection styles */
      .sample-header {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("/assets/images/banner.jpg");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 60px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
      }

      .sample-header h1 {
        font-size: 32px;
        margin-bottom: 15px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }

      .sample-header p {
        font-size: 18px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .instruction-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .instruction-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .warning-box {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 5px 5px 0;
      }

      .warning-title {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e65100;
      }

      .warning-icon {
        margin-right: 10px;
        font-size: 20px;
      }

      .steps-container {
        margin-top: 30px;
      }

      .step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
      }

      .step-number {
        width: 50px;
        height: 50px;
        background-color: #2196f3;
        color: white;
        font-size: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 20px;
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
      }

      .step-description {
        color: #555;
        line-height: 1.6;
      }

      .step-image {
        width: 100%;
        max-width: 300px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-timeline {
        position: absolute;
        left: 24px;
        top: 50px;
        bottom: -30px;
        width: 2px;
        background-color: #2196f3;
      }

      .step:last-child .step-timeline {
        display: none;
      }

      .step-tip {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-tip-title {
        font-weight: bold;
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        color: #0d47a1;
      }

      .step-tip-icon {
        margin-right: 8px;
      }

      .step-bullet-list {
        margin-top: 15px;
        margin-left: 5px;
        list-style-type: none;
      }

      .step-bullet-list li {
        position: relative;
        padding-left: 28px;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .step-bullet-list li:before {
        content: "•";
        position: absolute;
        left: 0;
        top: 0;
        color: #2196f3;
        font-size: 24px;
        line-height: 1;
      }

      .step-image-container {
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .step-image-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .step-image {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 8px;
      }

      .step-content {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .step-text {
        flex: 1;
        min-width: 300px;
      }

      .step-visual {
        flex: 1;
        min-width: 300px;
        padding-left: 20px;
        display: flex;
        justify-content: center;
      }
      .sample-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .sample-type {
        flex: 1;
        min-width: 250px;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
      }
      .sample-type:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .step-content {
          flex-direction: column;
        }

        .step-visual {
          padding-left: 0;
          margin-top: 20px;
          width: 100%;
        }
      }
      .sample-type-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: center;
      }

      .sample-type-icon {
        margin-right: 10px;
        color: #2196f3;
        font-size: 20px;
      }

      .sample-type-content {
        color: #555;
        line-height: 1.5;
      }

      /* Video section */
      .video-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .video-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
      }

      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* FAQs section */
      .faq-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .faq-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .faq-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .faq-question {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: flex-start;
      }

      .question-icon {
        color: #2196f3;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .faq-answer {
        color: #555;
        line-height: 1.6;
        padding-left: 30px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .step {
          flex-direction: column;
        }

        .step-number {
          margin-bottom: 15px;
          margin-right: 0;
        }

        .step-timeline {
          display: none;
        }
      }
      .highlighted-step {
        animation: highlight-step 3s ease;
      }

      @keyframes highlight-step {
        0%,
        100% {
          background-color: transparent;
        }
        20%,
        80% {
          background-color: rgba(33, 150, 243, 0.1);
          box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
          transform: translateY(-5px);
        }
      }

      /* Đảm bảo các bước có đủ padding cho hiệu ứng */
      .step {
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }
      .menu-icon i {
        font-size: 18px;
        width: 20px;
        text-align: center;
      } /* Menu styles */
      #mainMenu {
        padding: 10px;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #2196f3;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1976d2;
      }

      /* Modal animation */
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Modal responsive styles */
      /* @media (max-width: 768px) {
        #kit-modal-content {
          width: 95%;
          margin: 10px;
        }

        #kit-modal-iframe {
          height: 85vh;
        }
      } */

      /* Custom scrollbar for modal */
      /* #kit-modal-overlay::-webkit-scrollbar {
        width: 8px;
      }

      #kit-modal-overlay::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb {
        background: rgba(33, 150, 243, 0.5);
        border-radius: 10px;
      }

      #kit-modal-overlay::-webkit-scrollbar-thumb:hover {
        background: rgba(33, 150, 243, 0.7);
      } */

      /* Ẩn nút tăng/giảm ở input type=number cho mọi trình duyệt */
      /* #kit-appointment-id::-webkit-outer-spin-button,
      #kit-appointment-id::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      #kit-appointment-id[type="number"] {
        -moz-appearance: textfield;
        appearance: textfield;
      } */

      /* Override với specificity cao hơn */
      body #kitFilterForm {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 14px !important;
        align-items: flex-end !important;
        width: 100% !important;
        justify-content: stretch !important;
      }

      body #kitFilterForm > div {
        margin: 0 !important;
      }

      body #kitFilterForm input,
      body #kitFilterForm select {
        margin: 0 !important;
        padding: 10px 12px !important;
        border: 1px solid #ddd !important;
        border-radius: 6px !important;
        outline: none !important;
        background: #fff !important;
      }

      body #kitFilterForm button {
        margin: 0 !important;
        padding: 10px 18px !important;
        border: none !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        white-space: nowrap !important;
        min-width: 44px !important;
      }

      body #kitFilterForm button[type="submit"] {
        background: #2196f3 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.08) !important;
      }

      body #kitFilterForm button[type="reset"] {
        background: #f44336 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08) !important;
        min-width: 90px !important;
      }

      .login-register {
        padding: 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(245, 245, 245, 0.6));
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        margin: 15px;
        margin-bottom: 20px; /* Đồng bộ với staff-index.html */
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }
      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 20px 0 20px;
      }
      .text-container {
        display: flex;
        flex-direction: column;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }
      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }
      #mainMenu {
        padding: 10px 15px;
      }
      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }
      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.1), transparent);
        transition: left 0.6s ease;
      }
      .menu-item:hover::before {
        left: 100%;
      }
      .menu-item:hover {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }
      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
      }
      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(33, 150, 243, 0.08));
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }
      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      /* Toast notification styles */
      .toast-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
        z-index: 20000;
        opacity: 1;
        transition: opacity 0.3s ease;
        max-width: 350px; /* Thêm giới hạn chiều rộng */
      }
      .toast-content {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #333;
      }
      .toast-error {
        background: #fff0f0;
        color: #f44336;
        border: 1px solid #f44336;
      }
      .toast-warning {
        background: #fff8e1;
        color: #ff9800;
        border: 1px solid #ff9800;
      }
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
    </style>
  </head>

  <body>
    <script th:inline="javascript">
      /*<![CDATA[*/
      window.serverStaff = /*[[${staffData}]]*/ null;
      /*]]>*/
    </script>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo-container">
        <img src="/assets/images/logo.png" alt="Logo" class="logo" />
        <div class="text-container">
          <div class="logo-text">Genx</div>
          <div class="logo-subtext">Trung tâm xét nghiệm ADN huyết thống</div>
        </div>
      </div>
      <div class="login-register" id="login-register">
        <div id="user-info-container"></div>
      </div>
      <div class="menu-title">MAIN MENU</div>
      <div id="mainMenu">
        <a href="/staff-home" class="menu-item">
          <span class="menu-icon"><i class="fas fa-home"></i></span>
          Trang chủ
        </a>
        <a href="/staff-appointments" class="menu-item">
          <span class="menu-icon"><i class="fas fa-clipboard-list"></i></span>
          Danh sách lịch hẹn
        </a>
        <a href="/staff-kit-list" class="menu-item active">
          <span class="menu-icon"><i class="fas fa-vials"></i></span>
          Quản lý kit xét nghiệm
        </a>
        <a href="/payment-management" class="menu-item">
          <span class="menu-icon"><i class="fas fa-money-bill-wave"></i></span>
          Quản lý thanh toán
        </a>
        <a href="/staff-participants" class="menu-item">
          <span class="menu-icon"><i class="fas fa-users"></i></span>
          Quản lý người tham gia
        </a>
        <a href="/staff-samples" class="menu-item">
          <span class="menu-icon"><i class="fas fa-flask"></i></span>
          Quản lý mẫu xét nghiệm
        </a>
        <a href="/staff-results" class="menu-item">
          <span class="menu-icon"><i class="fas fa-chart-line"></i></span>
          Quản lý kết quả xét nghiệm
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Navigation Bar -->
      <div id="topNavbar" class="navbar">
        <!-- Navbar sẽ được thêm bằng JavaScript -->
      </div>
      <!-- Phần cần code -->
      <div class="instruction-container" style="margin-top: 10px">
        <div class="instruction-title">
          <i class="fas fa-vial" style="color: #2196f3"></i>
          Danh sách kit xét nghiệm ADN
        </div>
        <!-- Bộ lọc -->
        <div
          style="
            background: #fafbfc;
            border-radius: 10px;
            padding: 24px 20px 18px 20px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.04);
            width: 100%;
          "
        >
          <form
            id="kitFilterForm"
            style="
              display: flex;
              flex-wrap: nowrap;
              gap: 14px;
              align-items: flex-end;
              width: 100%;
              justify-content: stretch;
            "
          >
            <div style="flex: 1; min-width: 0">
              <label
                for="searchCombined"
                style="display: block; margin-bottom: 5px; font-weight: 500"
                >Tìm kiếm (Mã cuộc hẹn hoặc Tên khách hàng):</label
              >
              <input
                type="text"
                id="searchCombined"
                name="search"
                placeholder="Nhập mã cuộc hẹn hoặc tên khách hàng..."
                style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 1px solid #ddd;
                  border-radius: 6px;
                  outline: none;
                  background: #fff;
                "
              />
            </div>
            <div style="flex: 1; min-width: 0">
              <label
                for="filterStatus"
                style="display: block; margin-bottom: 5px; font-weight: 500"
                >Lọc theo trạng thái:</label
              >
              <select
                id="filterStatus"
                name="status"
                style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 1px solid #ddd;
                  border-radius: 6px;
                  outline: none;
                  background: #fff;
                "
              >
                <option value="">Tất cả trạng thái</option>
                <option value="Chưa gửi">Chưa gửi</option>
                <option value="Đã gửi">Đã gửi</option>
                <option value="Đã giao thành công">Đã giao thành công</option>
                <option value="Chưa nhận mẫu">Chưa nhận mẫu</option>
                <option value="Đã nhận mẫu">Đã nhận mẫu</option>
                <option value="Lỗi mẫu">Lỗi mẫu</option>
              </select>
            </div>
            <div
              style="
                display: flex;
                flex-direction: row;
                gap: 8px;
                align-items: flex-end;
                flex: 0.5;
                min-width: 0;
              "
            >
              <button
                type="submit"
                style="
                  background: #2196f3;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  padding: 10px 18px;
                  cursor: pointer;
                  font-weight: 500;
                  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.08);
                  white-space: nowrap;
                  min-width: 44px;
                "
              >
                <i class="fas fa-search"></i>
              </button>
              <button
                type="reset"
                onclick="resetKitFilter()"
                style="
                  background: #f44336;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  padding: 10px 18px;
                  cursor: pointer;
                  font-weight: 500;
                  box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08);
                  white-space: nowrap;
                  min-width: 90px;
                "
              >
                <i class="fas fa-redo"></i> Đặt lại
              </button>
            </div>
          </form>
        </div>

        <!-- Bảng kit -->
        <div style="overflow-x: auto">
          <table
            style="
              width: 100%;
              border-collapse: collapse;
              margin-top: 10px;
              table-layout: fixed;
            "
          >
            <thead>
              <tr style="background: #e3f2fd">
                <th
                  style="
                    padding: 12px 8px;
                    border-bottom: 1px solid #eee;
                    width: 10%;
                    text-align: left;
                  "
                >
                  Mã cuộc hẹn
                </th>
                <th
                  style="
                    padding: 12px 8px;
                    border-bottom: 1px solid #eee;
                    width: 25%;
                    text-align: left;
                  "
                >
                  Tên khách hàng
                </th>
                <th
                  style="
                    padding: 12px 8px;
                    border-bottom: 1px solid #eee;
                    width: 25%;
                    text-align: left;
                  "
                >
                  Địa chỉ
                </th>
                <th
                  style="
                    padding: 12px 8px;
                    border-bottom: 1px solid #eee;
                    width: 15%;
                    text-align: left;
                  "
                >
                  Trạng thái
                </th>
                <th
                  style="
                    padding: 12px 0px;
                    border-bottom: 1px solid #eee;
                    width: 25%;
                    text-align: left;
                  "
                >
                  Thao tác
                </th>
              </tr>
            </thead>
            <tbody id="kitTableBody">
              <!-- Dữ liệu sẽ được render bằng JS -->
            </tbody>
          </table>
        </div>
        <div
          id="kitPagination"
          style="
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            gap: 8px;
          "
        ></div>

        <!-- Modal Xem Kit -->
        <div
          id="view-kit-modal"
          style="
            display: none;
            position: fixed;
            z-index: 10002;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
          "
        >
          <div
            style="
              background: white;
              border-radius: 12px;
              padding: 30px;
              width: 90%;
              max-width: 600px;
              max-height: 90vh;
              overflow-y: auto;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
              "
            >
              <h2 style="margin: 0; color: #333; font-size: 24px">
                <i
                  class="fas fa-vials"
                  style="color: #2196f3; margin-right: 10px"
                ></i>
                Thông tin Kit Xét Nghiệm
              </h2>
              <button
                onclick="closeViewKitModal()"
                style="
                  background: none;
                  border: none;
                  font-size: 24px;
                  color: #999;
                  cursor: pointer;
                  width: 30px;
                  height: 30px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  border-radius: 50%;
                  transition: all 0.2s ease;
                "
                onmouseover="this.style.backgroundColor='#f5f5f5'; this.style.color='#666'"
                onmouseout="this.style.backgroundColor='transparent'; this.style.color='#999'"
              >
                ×
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 20px">
              <!-- ID Cuộc hẹn -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  ID Cuộc hẹn
                </label>
                <div
                  id="view-kit-appointment-id"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>

              <!-- Dịch vụ -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Dịch vụ
                </label>
                <div
                  id="view-kit-service"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>

              <!-- Kit Code -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Kit Code
                </label>
                <div
                  id="view-kit-code"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>

              <!-- Kit Type -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Kit Type
                </label>
                <div
                  id="view-kit-type"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>

              <!-- Ngày gửi -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Ngày gửi
                </label>
                <div
                  id="view-kit-send-date"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>

              <!-- Ngày nhận -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Ngày nhận
                </label>
                <div
                  id="view-kit-receive-date"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                  "
                ></div>
              </div>
              <!-- Trạng thái -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Trạng thái
                </label>
                <div
                  id="view-kit-status"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    font-weight: bold;
                  "
                ></div>
              </div>

              <!-- Ghi chú -->
              <div>
                <label
                  style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #333;
                  "
                >
                  Ghi chú
                </label>
                <div
                  id="view-kit-note"
                  style="
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background-color: #f9f9f9;
                    font-size: 14px;
                    color: #666;
                    min-height: 80px;
                  "
                ></div>
              </div>
            </div>

            <!-- Buttons -->
            <div style="display: flex; gap: 12px; margin-top: 30px">
              <button
                onclick="closeViewKitModal()"
                style="
                  flex: 1;
                  padding: 12px;
                  border: 2px solid #e0e0e0;
                  border-radius: 8px;
                  background: white;
                  color: #666;
                  font-size: 16px;
                  font-weight: 600;
                  cursor: pointer;
                  transition: all 0.3s ease;
                "
                onmouseover="this.style.backgroundColor='#f5f5f5'; this.style.borderColor='#ccc'"
                onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e0e0e0'"
              >
                Đóng
              </button>
              <button
                onclick="editKitFromView()"
                style="
                  flex: 1;
                  padding: 12px;
                  border: none;
                  border-radius: 8px;
                  background: linear-gradient(135deg, #2196f3, #1976d2);
                  color: white;
                  font-size: 16px;
                  font-weight: 600;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
                "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(33, 150, 243, 0.4)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(33, 150, 243, 0.3)'"
              >
                <i class="fas fa-edit" style="margin-right: 8px"></i>
                Chỉnh sửa
              </button>
            </div>
          </div>
        </div>

        <!-- Modal Chọn Kit -->
        <div
          id="kit-selection-modal"
          style="
            display: none;
            position: fixed;
            z-index: 10002;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            padding: 0;
            box-sizing: border-box;
          "
        >
          <div
            style="
              background: white;
              border-radius: 12px;
              padding: 30px;
              width: 90%;
              max-width: 600px;
              max-height: 90vh;
              overflow-y: auto;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              margin: auto;
              position: relative;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
                padding-bottom: 10px;
                border-bottom: 1px solid #f0f0f0;
              "
            >
              <h2 style="margin: 0; color: #333; font-size: 24px">
                <i
                  class="fas fa-vials"
                  style="color: #2196f3; margin-right: 10px"
                ></i>
                Chọn Kit Xét Nghiệm
              </h2>
              <button
                onclick="closeKitSelectionModal()"
                style="
                  background: none;
                  border: none;
                  font-size: 24px;
                  color: #999;
                  cursor: pointer;
                  width: 30px;
                  height: 30px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  border-radius: 50%;
                  transition: all 0.2s ease;
                "
                onmouseover="this.style.backgroundColor='#f5f5f5'; this.style.color='#666'"
                onmouseout="this.style.backgroundColor='transparent'; this.style.color='#999'"
              >
                ×
              </button>
            </div>

            <form
              id="kit-selection-form"
              style="
                display: flex;
                flex-direction: column;
                gap: 20px;
                overflow: visible;
              "
            >
              <!-- Thông tin cuộc hẹn -->
              <div
                style="background: #f8f9fa; padding: 15px; border-radius: 8px"
              >
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div>
                    <label
                      style="font-weight: 600; color: #666; font-size: 14px"
                      >Mã cuộc hẹn:</label
                    >
                    <div
                      id="select-kit-appointment-id"
                      style="font-size: 16px; color: #333; margin-top: 5px"
                    ></div>
                  </div>
                  <div>
                    <label
                      style="font-weight: 600; color: #666; font-size: 14px"
                      >Khách hàng:</label
                    >
                    <div
                      id="select-kit-customer-name"
                      style="font-size: 16px; color: #333; margin-top: 5px"
                    ></div>
                  </div>
                </div>
              </div>

              <!-- Container cho tất cả các dịch vụ -->
              <div
                id="services-container"
                style="
                  display: flex;
                  flex-direction: column;
                  gap: 20px;
                  overflow: visible;
                "
              >
                <!-- Services will be dynamically added here -->
              </div>

              <!-- Hidden fields -->
              <input type="hidden" id="selected-appointment-id" />

              <!-- Buttons -->
              <div style="display: flex; gap: 12px; margin-top: 20px">
                <button
                  type="submit"
                  style="
                    flex: 1;
                    padding: 12px;
                    flex: 1;
                    padding: 12px;
                    border: none;
                    border-radius: 8px;
                    background: linear-gradient(135deg, #4caf50, #45a049);
                    color: white;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
                    width: 100%;
                  "
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(76, 175, 80, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(76, 175, 80, 0.3)'"
                >
                  <i class="fas fa-check" style="margin-right: 8px"></i>
                  Xác nhận
                </button>
              </div>
            </form>
          </div>
        </div>

        <script>
          // Hàm hiển thị modal xác nhận tùy chỉnh
          function showConfirmModal(message, onConfirm) {
            const modal = document.createElement("div");
            modal.className = "confirm-modal";
            modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
              background-color: rgba(0,0,0,0.5); display: flex; align-items: center; 
              justify-content: center; z-index: 1000; backdrop-filter: blur(5px);
            `;

            modal.innerHTML = `
              <div class="modal-content" style="
                background: linear-gradient(135deg, #ffffff, #f8f9fa);
                border-radius: 16px; padding: 30px; width: 450px; max-width: 90%;
                box-shadow: 0 20px 40px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.2);
                animation: modalSlideIn 0.3s ease;
              ">
                <div style="text-align: center; margin-bottom: 25px;">
                  <div style="
                    width: 60px; height: 60px; border-radius: 50%; 
                    background: linear-gradient(135deg, #2196f3, #1976d2);
                    display: flex; align-items: center; justify-content: center;
                    margin: 0 auto 15px; box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
                  ">
                    <i class="fas fa-question" style="color: white; font-size: 24px;"></i>
                  </div>
                  <h3 style="margin: 0; color: #333; font-size: 20px; font-weight: 600;">Xác nhận</h3>
                </div>
                
                <div style="
                  background: #f8f9fa; border-radius: 12px; padding: 20px; 
                  margin-bottom: 25px; border-left: 4px solid #2196f3;
                ">
                  <p style="margin: 0; color: #555; font-size: 16px; line-height: 1.5;">${message}</p>
                </div>

                <div style="display: flex; gap: 12px; justify-content: center;">
                  <button id="cancel-confirm" style="
                    padding: 12px 24px; border: 2px solid #e0e0e0; border-radius: 8px;
                    background: white; color: #666; font-size: 16px; font-weight: 600;
                    cursor: pointer; transition: all 0.3s ease; min-width: 100px;
                  " onmouseover="this.style.backgroundColor='#f5f5f5'; this.style.borderColor='#ccc'"
                     onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e0e0e0'">
                    <i class="fas fa-times" style="margin-right: 8px;"></i>Hủy bỏ
                  </button>
                  <button id="confirm-action" style="
                    padding: 12px 24px; border: none; border-radius: 8px;
                    background: linear-gradient(135deg, #2196f3, #1976d2); color: white;
                    font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3); min-width: 100px;
                  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(33, 150, 243, 0.4)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(33, 150, 243, 0.3)'">
                    <i class="fas fa-check" style="margin-right: 8px;"></i>Xác nhận
                  </button>
                </div>
              </div>
            `;

            document.body.appendChild(modal);

            // Add event listeners
            document.getElementById('cancel-confirm').addEventListener('click', () => {
              modal.remove();
            });

            document.getElementById('confirm-action').addEventListener('click', () => {
              const btn = document.getElementById('confirm-action');
              if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xử lý...';
              }
              if (onConfirm) onConfirm();
            });

            // Close on backdrop click
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.remove();
              }
            });

            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
              @keyframes modalSlideIn {
                from { opacity: 0; transform: translateY(-20px) scale(0.95); }
                to { opacity: 1; transform: translateY(0) scale(1); }
              }
            `;
            document.head.appendChild(style);
          }

          // Hàm đóng tất cả các modal xác nhận/cảnh báo liên quan
          function closeAllCustomModals() {
            document.querySelectorAll('.confirm-modal, .payment-warning-modal, .payment-error-modal').forEach(m => m.remove());
          }

          // Hàm hiển thị modal lỗi tùy chỉnh
          function showErrorModal(message) {
            const modal = document.createElement("div");
            modal.className = "error-modal";
            modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
              background-color: rgba(0,0,0,0.5); display: flex; align-items: center; 
              justify-content: center; z-index: 1000; backdrop-filter: blur(5px);
            `;

            modal.innerHTML = `
              <div class="modal-content" style="
                background: linear-gradient(135deg, #ffffff, #fff5f5);
                border-radius: 16px; padding: 30px; width: 450px; max-width: 90%;
                box-shadow: 0 20px 40px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.2);
                animation: modalSlideIn 0.3s ease;
              ">
                <div style="text-align: center; margin-bottom: 25px;">
                  <div style="
                    width: 60px; height: 60px; border-radius: 50%; 
                    background: linear-gradient(135deg, #f44336, #d32f2f);
                    display: flex; align-items: center; justify-content: center;
                    margin: 0 auto 15px; box-shadow: 0 8px 20px rgba(244, 67, 54, 0.3);
                  ">
                    <i class="fas fa-exclamation-triangle" style="color: white; font-size: 24px;"></i>
                  </div>
                  <h3 style="margin: 0; color: #333; font-size: 20px; font-weight: 600;">Lỗi</h3>
                </div>
                
                <div style="
                  background: #fff5f5; border-radius: 12px; padding: 20px; 
                  margin-bottom: 25px; border-left: 4px solid #f44336;
                ">
                  <p style="margin: 0; color: #c62828; font-size: 16px; line-height: 1.5;">${message}</p>
                </div>

                <div style="display: flex; justify-content: center;">
                  <button onclick="this.closest('.error-modal').remove()" style="
                    padding: 12px 24px; border: none; border-radius: 8px;
                    background: linear-gradient(135deg, #f44336, #d32f2f); color: white;
                    font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3); min-width: 100px;
                  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(244, 67, 54, 0.4)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(244, 67, 54, 0.3)'">
                    <i class="fas fa-times" style="margin-right: 8px;"></i>Đóng
                  </button>
                </div>
              </div>
            `;

            document.body.appendChild(modal);

            // Close on backdrop click
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.remove();
              }
            });
          }

          // Hàm mở modal chọn kit cho nhiều dịch vụ
          function openMultipleKitSelection(appointmentId) {
            // Fetch appointment services from API
            fetch(`/api/kits/appointment/${appointmentId}/services`)
              .then((response) => {
                if (!response.ok)
                  throw new Error("Failed to fetch appointment services");
                return response.json();
              })
              .then((appointmentServices) => {
                if (!appointmentServices || appointmentServices.length === 0) {
                  showErrorToast(
                    "Không tìm thấy dịch vụ nào cho cuộc hẹn này!"
                  );
                  return;
                }

                // Điền thông tin cuộc hẹn
                document.getElementById(
                  "select-kit-appointment-id"
                ).textContent = appointmentId;
                document.getElementById(
                  "select-kit-customer-name"
                ).textContent = appointmentServices[0].customerName;
                document.getElementById("selected-appointment-id").value =
                  appointmentId;

                // Render tất cả dịch vụ vào container
                renderServicesInModal(appointmentServices);

                // Reset tiêu đề modal về "Chọn Kit Xét Nghiệm"
                const modalTitle = document.querySelector('#kit-selection-modal h2');
                if (modalTitle) {
                  modalTitle.innerHTML = '<i class="fas fa-vials" style="color: #2196f3; margin-right: 10px"></i>Chọn Kit Xét Nghiệm';
                }

                // Hiển thị nút Submit và reset text
                const submitButton = document.querySelector(
                  '#kit-selection-form button[type="submit"]'
                );
                submitButton.style.display = "block";
                submitButton.innerHTML = '<i class="fas fa-check" style="margin-right: 8px"></i>Xác nhận';
                
                // Ẩn nút "Đóng" nếu có
                const buttonsContainer = document.querySelector('#kit-selection-form .buttons-container');
                if (buttonsContainer) {
                  buttonsContainer.style.display = 'none';
                }
                
                // Reset chế độ chỉnh sửa
                const editModeField = document.getElementById('edit-mode-field');
                if (editModeField) {
                  editModeField.value = 'false';
                }

                // Hiển thị modal
                document.getElementById("kit-selection-modal").style.display = "flex";
              })
              .catch((error) => {
                console.error("Error fetching appointment services:", error);
                showErrorToast(
                  "Could not load services for this appointment. Please try again later."
                );
              });
          }

          // Render tất cả dịch vụ vào modal
          function renderServicesInModal(services) {
            const container = document.getElementById("services-container");
            container.innerHTML = "";

            services.forEach((service, index) => {
              const serviceElement = document.createElement("div");
              serviceElement.className = "service-item";
              serviceElement.setAttribute("data-service-id", service.serviceId);
              serviceElement.style.padding = "15px";
              serviceElement.style.borderRadius = "8px";
              serviceElement.style.border = "1px solid #e0e0e0";

              serviceElement.innerHTML = `
                <div style="margin-bottom: 15px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;">
                  <label style="font-weight: 600; color: #666; font-size: 14px">Dịch vụ:</label>
                  <div style="font-size: 16px; color: #333; margin-top: 5px">${service.serviceName}</div>
                </div>

                <div style="margin-bottom: 15px">
                  <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Chọn loại Kit <span style="color: red">*</span>
                  </label>
                  <select
                    class="kit-type-selection"
                    data-service-id="${service.serviceId}"
                    required
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; background-color: white;"
                    onfocus="this.style.borderColor='#2196f3'"
                    onblur="this.style.borderColor='#e0e0e0'"
                  >
                    <option value="">Đang tải...</option>
                  </select>
                </div>
              `;

              container.appendChild(serviceElement);

              // Load kit types cho dịch vụ này
              loadKitTypesForMultiService(service.serviceId);
            });
          }

          // Hàm gửi kit đã chọn với kiểm tra thanh toán
          function sendKits(appointmentId) {
            // Lấy phương thức thanh toán từ kitList
            const appointment = kitList.find(item => String(item.appointmentId) === String(appointmentId));
            const paymentMethod = appointment && appointment.paymentMethod ? appointment.paymentMethod : null;
            if (!paymentMethod) {
              showErrorToast('Không xác định được phương thức thanh toán. Vui lòng kiểm tra lại dữ liệu cuộc hẹn!');
              return;
            }
            // Luôn kiểm tra điều kiện thanh toán trước khi xác nhận
            if (paymentMethod === 'BANK_TRANSFER') {
              fetch(`/api/kits/appointment/${appointmentId}/check-send-kit-payment`)
                .then(res => res.json())
                .then(data => {
                  if (data.ok) {
                    // Đủ điều kiện, mới hiện modal xác nhận
                    showConfirmModal('Bạn có chắc chắn muốn gửi kit cho cuộc hẹn này?', function onConfirmSendKit() {
                      doSendKits(appointmentId);
                    });
                    closeAllCustomModals();
                  } else {
                    showPaymentError(data, appointmentId, null);
                  }
                })
                .catch(err => {
                  showErrorToast('Lỗi kiểm tra thanh toán: ' + (err.message || ''));
                });
            } else {
              // Tiền mặt/COD: vẫn kiểm tra điều kiện thanh toán nếu có API tương ứng (nếu không, xác nhận luôn)
              showConfirmModal('Bạn có chắc chắn muốn gửi kit cho cuộc hẹn này?', function onConfirmSendKit() {
                doSendKits(appointmentId);
              });
                closeAllCustomModals();
            }
          }

          function doSendKits(appointmentId) {
            fetch(`/api/kits/appointment/${appointmentId}/send`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ sendDate: new Date().toISOString().split("T")[0] })
            })
              .then(response => {
                if (!response.ok) {
                  return response.text().then(errorMessage => { throw new Error(errorMessage || 'Có lỗi xảy ra khi gửi kit.'); });
                }
                return response.text();
              })
              .then(message => {
                showSuccessToast('Gửi kit thành công!');
                setTimeout(() => window.location.reload(), 1000);
              })
              .catch(error => {
                showErrorToast('Có lỗi xảy ra khi gửi kit: ' + (error.message || ''));
              });
          }


          // Nhắc thanh toán 10%: xác nhận trước khi gửi mail
          function remind10PercentPayment(appointmentId) {
            showConfirmModal('Bạn có chắc chắn muốn gửi nhắc thanh toán 10% cho khách hàng?', function onConfirmRemind10() {
              STAFF_API.PAYMENT.remind10PercentPayment(appointmentId)
                .then(msg => {
                    closeAllCustomModals();
                  showSuccessToast('Đã gửi nhắc thanh toán 10% cho khách hàng!');
                })
                .catch(err => {
                  showErrorToast('Không gửi được nhắc thanh toán: ' + (err.message || ''));
                });
            });
          }

          // Nhắc thanh toán đủ: xác nhận trước khi gửi mail
          function remindFullPayment(appointmentId) {
            showConfirmModal('Bạn có chắc chắn muốn gửi nhắc thanh toán đủ cho khách hàng?', function onConfirmRemindFull() {
              STAFF_API.PAYMENT.remindFullPayment(appointmentId)
                .then(msg => {
                    closeAllCustomModals();
                  showSuccessToast('Đã gửi nhắc thanh toán đủ cho khách hàng!');
                })
                .catch(err => {
                  showErrorToast('Không gửi được nhắc thanh toán: ' + (err.message || ''));
                });
            });
          }

          // Hàm hiển thị thông tin kit đã chọn
          function viewAppointmentServices(appointmentId) {
            console.log('Opening view modal for appointmentId:', appointmentId);
            // Fetch appointment services from API để lấy thông tin đầy đủ
            fetch(`/api/kits/appointment/${appointmentId}/services`)
              .then((response) => {
                if (!response.ok)
                  throw new Error("Failed to fetch appointment services");
                return response.json();
              })
              .then((appointmentServices) => {
                console.log('Fetched appointment services:', appointmentServices);
                if (!appointmentServices || appointmentServices.length === 0) {
                  showErrorToast(
                    "Không tìm thấy dịch vụ nào cho cuộc hẹn này!"
                  );
                  return;
                }

                // Điền thông tin cuộc hẹn vào modal xem
                document.getElementById("select-kit-appointment-id").textContent = appointmentId;
                document.getElementById("select-kit-customer-name").textContent = appointmentServices[0].customerName;
                document.getElementById("selected-appointment-id").value = appointmentId;

                // Render tất cả dịch vụ vào container - chế độ xem
                const container = document.getElementById("services-container");
                container.innerHTML = "";

                appointmentServices.forEach((service, index) => {
                  const serviceElement = document.createElement("div");
                  serviceElement.className = "service-item";
                  serviceElement.style.padding = "15px";
                  serviceElement.style.borderRadius = "8px";
                  serviceElement.style.border = "1px solid #e0e0e0";
                  serviceElement.style.marginBottom = "15px";

                  serviceElement.innerHTML = `
                    <div style="margin-bottom: 15px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;">
                      <label style="font-weight: 600; color: #666; font-size: 14px">Dịch vụ:</label>
                      <div style="font-size: 16px; color: #333; margin-top: 5px">${service.serviceName}</div>
                    </div>

                    <div style="margin-bottom: 15px">
                      <label style="font-weight: 600; color: #666; font-size: 14px">Loại Kit:</label>
                      <div style="font-size: 16px; color: #333; margin-top: 5px">${service.kitTypeName || (service.kitType ? (typeof service.kitType === 'object' ? service.kitType.name : service.kitType) : "Chưa chọn")}</div>
                    </div>
                  `;

                  container.appendChild(serviceElement);
                });

                // Ẩn nút Submit, hiển thị modal
                const submitButton = document.querySelector(
                  '#kit-selection-form button[type="submit"]'
                );
                submitButton.style.display = "none";

                // Thay đổi tiêu đề modal thành "Xem thông tin Kit"
                const modalTitle = document.querySelector('#kit-selection-modal h2');
                if (modalTitle) {
                  modalTitle.innerHTML = '<i class="fas fa-eye" style="color: #2196f3; margin-right: 10px"></i>Xem thông tin Kit Xét Nghiệm';
                }

                // Thêm nút "Đóng" và "Chỉnh sửa" vào cuối modal khi ở chế độ xem
                const buttonsContainer = document.querySelector('#kit-selection-form .buttons-container');
                if (!buttonsContainer) {
                  const buttonsDiv = document.createElement('div');
                  buttonsDiv.className = 'buttons-container';
                  buttonsDiv.style.cssText = 'display: flex; gap: 12px; margin-top: 20px;';

                  // Kiểm tra trạng thái để quyết định hiển thị nút chỉnh sửa
                  const currentStatus = getCurrentAppointmentStatus(appointmentId);
                  console.log('Current status for edit button:', currentStatus);
                  const showEditButton = currentStatus === "Chưa gửi";
                  console.log('Show edit button:', showEditButton);

                  buttonsDiv.innerHTML = `
                    <button type="button" onclick="closeKitSelectionModal()" style="
                      flex: 1;
                      padding: 12px;
                      border: 2px solid #e0e0e0;
                      border-radius: 8px;
                      background: white;
                      color: #666;
                      font-size: 16px;
                      font-weight: 600;
                      cursor: pointer;
                      transition: all 0.3s ease;
                    " onmouseover="this.style.backgroundColor='#f5f5f5'; this.style.borderColor='#ccc'" onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e0e0e0'">
                      <i class="fas fa-times" style="margin-right: 8px"></i>Đóng
                    </button>
                    ${showEditButton ? `
                    <button type="button" onclick="editKitFromView('${appointmentId}')" style="
                      flex: 1;
                      padding: 12px;
                      border: none;
                      border-radius: 8px;
                      background: linear-gradient(135deg, #2196f3, #1976d2);
                      color: white;
                      font-size: 16px;
                      font-weight: 600;
                      cursor: pointer;
                      transition: all 0.3s ease;
                      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(33, 150, 243, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(33, 150, 243, 0.3)'">
                      <i class="fas fa-edit" style="margin-right: 8px"></i>Chỉnh sửa
                    </button>
                    ` : ''}
                  `;
                  document.getElementById('kit-selection-form').appendChild(buttonsDiv);
                } else {
                  buttonsContainer.style.display = 'flex';
                }

                document.getElementById("kit-selection-modal").style.display = "flex";
              })
              .catch((error) => {
                console.error("Error fetching appointment services:", error);
                showErrorToast(
                  "Không thể tải thông tin dịch vụ. Vui lòng thử lại sau."
                );
              });
          }

          // Hàm load kit types theo dịch vụ (for legacy support)
          // Hàm load kit types cho một dịch vụ trong modal
          function loadKitTypesForMultiService(serviceId) {
            // Kiểm tra nếu serviceId là một object (trường hợp từ hàm renderServicesInModal)
            if (typeof serviceId === "object" && serviceId !== null) {
              // Trường hợp gọi từ renderServicesInModal
              const service = serviceId;
              serviceId = service.serviceId;

              // Phần còn lại của code xử lý object service...
              // (Phần này đã có trong hàm renderServicesInModal)
            }

            // Trường hợp serviceId là một chuỗi/số (gọi từ hàm legacy)
            const kitTypeSelect = document.querySelector(
              `.kit-type-selection[data-service-id="${serviceId}"]`
            );

            if (!kitTypeSelect) {
              console.error(
                `Could not find kit type selection for service ${serviceId}`
              );
              return;
            }

            kitTypeSelect.innerHTML = '<option value="">Đang tải...</option>';
            kitTypeSelect.disabled = true;

            fetch(`/api/kits/services/${serviceId}/kit-types`)
              .then((response) => {
                if (!response.ok) throw new Error("Failed to load kit types");
                return response.json();
              })
              .then((kitTypes) => {
                if (!kitTypes || kitTypes.length === 0) {
                  kitTypeSelect.innerHTML =
                    '<option value="">Không có kit phù hợp cho dịch vụ này</option>';
                  return;
                }

                kitTypeSelect.innerHTML =
                  '<option value="">Chọn loại kit</option>' +
                  kitTypes
                    .map(
                      (kt) =>
                        `<option value="${kt.id}" data-name="${kt.name}">${
                          kt.name
                        } - ${kt.description || ""}</option>`
                    )
                    .join("");
                kitTypeSelect.disabled = false;
              })
              .catch((error) => {
                console.error("Error loading kit types:", error);
                kitTypeSelect.innerHTML =
                  '<option value="">Lỗi tải dữ liệu</option>';
              });
          }

          // Hàm đóng modal chọn kit
          function closeKitSelectionModal() {
            document.getElementById("kit-selection-modal").style.display = "none";
            document.getElementById("kit-selection-form").reset();
            document.getElementById("services-container").innerHTML = "";
            
            // Reset tiêu đề modal về mặc định
            const modalTitle = document.querySelector('#kit-selection-modal h2');
            if (modalTitle) {
              modalTitle.innerHTML = '<i class="fas fa-vials" style="color: #2196f3; margin-right: 10px"></i>Chọn Kit Xét Nghiệm';
            }
            
            // Hiển thị nút Submit và reset text
            const submitButton = document.querySelector(
              '#kit-selection-form button[type="submit"]'
            );
            submitButton.style.display = "block";
            submitButton.innerHTML = '<i class="fas fa-check" style="margin-right: 8px"></i>Xác nhận';
            
            // Ẩn nút "Đóng" nếu có
            const buttonsContainer = document.querySelector('#kit-selection-form .buttons-container');
            if (buttonsContainer) {
              buttonsContainer.style.display = 'none';
            }
            
            // Reset chế độ chỉnh sửa
            const editModeField = document.getElementById('edit-mode-field');
            if (editModeField) {
              editModeField.value = 'false';
            }
          }

          // Hàm lấy trạng thái hiện tại của appointment
          function getCurrentAppointmentStatus(appointmentId) {
            // Nhóm dữ liệu theo appointmentId trước khi tìm kiếm
            const groupedData = groupByAppointment(kitList);
            const appointment = groupedData.find(item => String(item.appointmentId) === String(appointmentId));
            console.log('Finding status for appointmentId:', appointmentId);
            console.log('Grouped appointments:', groupedData.map(item => ({ id: item.appointmentId, status: item.status })));
            console.log('Found appointment:', appointment);
            return appointment ? appointment.status : null;
          }

          // Hàm chuyển từ chế độ xem sang chế độ chỉnh sửa
          function editKitFromView(appointmentId) {
            // Fetch appointment services từ API để lấy thông tin đầy đủ bao gồm kitType hiện tại
            fetch(`/api/kits/appointment/${appointmentId}/services`)
              .then((response) => {
                if (!response.ok)
                  throw new Error("Failed to fetch appointment services");
                return response.json();
              })
              .then((appointmentServices) => {
                if (!appointmentServices || appointmentServices.length === 0) {
                  showErrorToast(
                    "Không tìm thấy dịch vụ nào cho cuộc hẹn này!"
                  );
                  return;
                }

                // Điền thông tin cuộc hẹn
                document.getElementById("select-kit-appointment-id").textContent = appointmentId;
                document.getElementById("select-kit-customer-name").textContent = appointmentServices[0].customerName;
                document.getElementById("selected-appointment-id").value = appointmentId;

                // Render tất cả dịch vụ vào container - chế độ chỉnh sửa
                renderServicesInEditMode(appointmentServices);

                // Thay đổi tiêu đề modal thành "Chỉnh sửa Kit Xét Nghiệm"
                const modalTitle = document.querySelector('#kit-selection-modal h2');
                if (modalTitle) {
                  modalTitle.innerHTML = '<i class="fas fa-edit" style="color: #2196f3; margin-right: 10px"></i>Chỉnh sửa Kit Xét Nghiệm';
                }

                // Hiển thị nút Submit
                const submitButton = document.querySelector(
                  '#kit-selection-form button[type="submit"]'
                );
                submitButton.style.display = "block";
                submitButton.innerHTML = '<i class="fas fa-save" style="margin-right: 8px"></i>Cập nhật';

                // Ẩn nút "Đóng" và "Chỉnh sửa"
                const buttonsContainer = document.querySelector('#kit-selection-form .buttons-container');
                if (buttonsContainer) {
                  buttonsContainer.style.display = 'none';
                }

                // Thêm hidden field để đánh dấu đây là chế độ chỉnh sửa
                let editModeField = document.getElementById('edit-mode-field');
                if (!editModeField) {
                  editModeField = document.createElement('input');
                  editModeField.type = 'hidden';
                  editModeField.id = 'edit-mode-field';
                  editModeField.value = 'true';
                  document.getElementById('kit-selection-form').appendChild(editModeField);
                } else {
                  editModeField.value = 'true';
                }
              })
              .catch((error) => {
                console.error("Error fetching appointment services:", error);
                showErrorToast(
                  "Không thể tải thông tin dịch vụ. Vui lòng thử lại sau."
                );
              });
          }

          // Render tất cả dịch vụ vào modal - chế độ chỉnh sửa
          function renderServicesInEditMode(services) {
            const container = document.getElementById("services-container");
            container.innerHTML = "";

            services.forEach((service, index) => {
              const serviceElement = document.createElement("div");
              serviceElement.className = "service-item";
              serviceElement.setAttribute("data-service-id", service.serviceId);
              serviceElement.style.padding = "15px";
              serviceElement.style.borderRadius = "8px";
              serviceElement.style.border = "1px solid #e0e0e0";

              serviceElement.innerHTML = `
                <div style="margin-bottom: 15px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;">
                  <label style="font-weight: 600; color: #666; font-size: 14px">Dịch vụ:</label>
                  <div style="font-size: 16px; color: #333; margin-top: 5px">${service.serviceName}</div>
                </div>

                <div style="margin-bottom: 15px">
                  <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Chọn loại Kit <span style="color: red">*</span>
                  </label>
                  <select
                    class="kit-type-selection"
                    data-service-id="${service.serviceId}"
                    required
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; background-color: white;"
                    onfocus="this.style.borderColor='#2196f3'"
                    onblur="this.style.borderColor='#e0e0e0'"
                  >
                    <option value="">Đang tải...</option>
                  </select>
                </div>
              `;

              container.appendChild(serviceElement);

              // Load kit types cho dịch vụ này và set giá trị hiện tại
              loadKitTypesForEditMode(service.serviceId, service.kitTypeId);
            });
          }

          // Hàm load kit types cho chế độ chỉnh sửa
          function loadKitTypesForEditMode(serviceId, currentKitTypeId) {
            const kitTypeSelect = document.querySelector(
              `.kit-type-selection[data-service-id="${serviceId}"]`
            );

            if (!kitTypeSelect) {
              console.error(
                `Could not find kit type selection for service ${serviceId}`
              );
              return;
            }

            kitTypeSelect.innerHTML = '<option value="">Đang tải...</option>';
            kitTypeSelect.disabled = true;

            fetch(`/api/kits/services/${serviceId}/kit-types`)
              .then((response) => {
                if (!response.ok) throw new Error("Failed to load kit types");
                return response.json();
              })
              .then((kitTypes) => {
                if (!kitTypes || kitTypes.length === 0) {
                  kitTypeSelect.innerHTML =
                    '<option value="">Không có kit phù hợp cho dịch vụ này</option>';
                  return;
                }

                kitTypeSelect.innerHTML =
                  '<option value="">Chọn loại kit</option>' +
                  kitTypes
                    .map(
                      (kt) =>
                        `<option value="${kt.id}" data-name="${kt.name}" ${kt.id == currentKitTypeId ? 'selected' : ''}>${
                          kt.name
                        } - ${kt.description || ""}</option>`
                    )
                    .join("");
                kitTypeSelect.disabled = false;
              })
              .catch((error) => {
                console.error("Error loading kit types:", error);
                kitTypeSelect.innerHTML =
                  '<option value="">Lỗi tải dữ liệu</option>';
              });
          }

          // Tự động cập nhật UI khi chọn loại kit
          document.addEventListener("change", function (e) {
            if (e.target && e.target.classList.contains("kit-type-selection")) {
              // Reset border color khi đã chọn
              if (e.target.value) {
                e.target.style.borderColor = "#2196f3";
              }
            }


          });

          // Xử lý submit form chọn kit
          document
            .getElementById("kit-selection-form")
            .addEventListener("submit", function (e) {
              e.preventDefault();

              const appointmentId = document.getElementById(
                "selected-appointment-id"
              ).value;

              // Kiểm tra xem có phải chế độ chỉnh sửa không
              const isEditMode = document.getElementById('edit-mode-field')?.value === 'true';

              // Kiểm tra tất cả các service sections
              const serviceItems = document.querySelectorAll(".service-item");
              let hasError = false;

              serviceItems.forEach((serviceItem) => {
                const serviceId = serviceItem.getAttribute("data-service-id");
                const kitTypeSelect = serviceItem.querySelector(
                  `.kit-type-selection[data-service-id="${serviceId}"]`
                );
                if (!kitTypeSelect.value) {
                  kitTypeSelect.style.borderColor = "#f44336";
                  hasError = true;
                }
              });

              if (hasError) {
                alert("Vui lòng điền đầy đủ thông tin cho tất cả các dịch vụ!");
                return;
              }

              // Prepare data for API call
              const kitSelections = [];
              serviceItems.forEach((serviceItem) => {
                const serviceId = serviceItem.getAttribute("data-service-id");
                const kitTypeSelect = serviceItem.querySelector(
                  `.kit-type-selection[data-service-id="${serviceId}"]`
                );
                const kitTypeId = kitTypeSelect.value;

                kitSelections.push({
                  appointmentId,
                  serviceId,
                  kitTypeId,
                });
              });

              // Chọn API endpoint dựa trên chế độ
              const apiEndpoint = isEditMode ? "/api/kits/update-multiple" : "/api/kits/select-multiple";
              const method = isEditMode ? "PUT" : "POST";

              // Call API to save/update kit selections
              fetch(apiEndpoint, {
                method: method,
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(kitSelections),
              })
                .then((response) => {
                  if (!response.ok) {
                    return response.text().then((errorMessage) => {
                      throw new Error(errorMessage || `Failed to ${isEditMode ? 'update' : 'save'} kit selections`);
                    });
                  }
                  return response.text();
                })
                .then((message) => {
                  if (isEditMode) {
                    showSuccessToast("Đã cập nhật kit thành công!");
                  } else {
                    // Hiển thị nút "Gửi kit" và ẩn nút "Chọn kit"
                    const chooseKitBtn = document.querySelector(
                      `button[onclick="openMultipleKitSelection('${appointmentId}')"]`
                    );
                    const sendKitBtn = document.getElementById(
                      `send-kit-btn-${appointmentId}`
                    );

                    if (chooseKitBtn && sendKitBtn) {
                      chooseKitBtn.style.display = "none";
                      sendKitBtn.style.display = "inline-block";
                    }

                    showSuccessToast(
                      "Đã chọn kit thành công! Vui lòng nhấn nút Gửi kit để hoàn tất."
                    );
                  }
                  
                  closeKitSelectionModal();

                  // Refresh data from server to get updated status
                  setTimeout(() => {
                    fetchKits(currentPage, pageSize, currentFilters);
                  }, 500);
                })
                .catch((error) => {
                  console.error(`Error ${isEditMode ? 'updating' : 'saving'} kit selections:`, error);
                  showErrorToast(
                    error.message || `Could not ${isEditMode ? 'update' : 'save'} kit selections. Please try again.`
                  );
                });
            });

          // Hàm cập nhật trạng thái kit
          function updateKitStatus(appointmentId, newStatus) {
            if (newStatus === 'Đã nhận mẫu') {
              fetch(`/api/kits/appointment/${appointmentId}/check-receive-sample-payment`)
                .then(res => res.json())
                .then(data => {
                  if (data.ok) {
                    // Thay vì cập nhật trạng thái trực tiếp, kiểm tra và nhập mẫu cho kit
                    checkAndHandleSampleInput(appointmentId, 'kit');
                  } else {
                    showPaymentError(data, appointmentId, newStatus);
                  }
                })
                .catch(err => {
                  showErrorToast('Lỗi kiểm tra thanh toán: ' + (err.message || ''));
                });
            } else {
              doUpdateKitStatus(appointmentId, newStatus);
            }
          }
          function doUpdateKitStatus(appointmentId, newStatus) {
            showConfirmModal(`Xác nhận chuyển trạng thái thành "${newStatus}"?`, () => {
              fetch(`/api/kits/appointment/${appointmentId}/status`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ status: newStatus, receiveDate: newStatus === "Đã nhận mẫu" ? new Date().toISOString().split("T")[0] : null })
              })
                .then(response => {
                  if (!response.ok) {
                    return response.text().then(errorMessage => { throw new Error(errorMessage || 'Failed to update status'); });
                  }
                  return response.text();
                })
                .then(message => {
                  closeAllCustomModals();
                  showSuccessToast(`Cập nhật trạng thái thành "${newStatus}" thành công!`);
                  fetchKits(currentPage, pageSize, currentFilters);
                })
                .catch(error => {
                  showErrorToast("Không thể cập nhật trạng thái: " + error.message);
                });
            });
          }

          // Hàm hiển thị lỗi thanh toán chưa đầy đủ
          function showPaymentError(data, appointmentId, newStatus) {
            const modal = document.createElement("div");
            modal.className = "payment-error-modal";
            modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
              background-color: rgba(0,0,0,0.5); display: flex; align-items: center; 
              justify-content: center; z-index: 1000;
            `;

            let messageHtml = data.message;
            if (data.hasPendingPayment) {
              // Tô đậm và đổi màu cụm từ 'có thanh toán cần xử lý'
              messageHtml = data.message.replace(/(Có thanh toán cần xử lý.)/i, '<span style="color:#d84315;font-weight:bold;background: #fff3e0; padding:2px 6px; border-radius:4px;">$1</span>');
            }

            let actionButtons = "";
            if (data.hasPendingPayment) {
              actionButtons = `
                <button onclick="this.closest('.payment-error-modal').remove()" class="btn" style="background: #f5f5f5; color: #666; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                  <i class="fas fa-times"></i> Đóng
                </button>
                <button onclick="window.open('/payment-management', '_blank')" class="btn" style="background: #2196f3; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                  <i class="fas fa-money-bill-wave"></i> Quản lý thanh toán
                </button>
              `;
            } else {
              actionButtons = `
                <button onclick="this.closest('.payment-error-modal').remove()" class="btn" style="background: #f5f5f5; color: #666; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                  <i class="fas fa-times"></i> Đóng
                </button>
                <button onclick="showAddPaymentModal(${appointmentId})" class="btn" style="background: #4caf50; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                  <i class="fas fa-plus-circle"></i> Thêm thanh toán
                </button>
                ${typeof data.message === 'string' && data.message.includes('10%')
                  ? `<button onclick="remind10PercentPayment(${appointmentId})" class="btn" style="background: #ff9800; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                      <i class="fas fa-bell"></i> Nhắc TT
                    </button>`
                  : `<button onclick="remindFullPayment(${appointmentId})" class="btn" style="background: #ff9800; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer;">
                      <i class="fas fa-bell"></i> Nhắc TT
                    </button>`
                }
              `;
            }

            modal.innerHTML = `
              <div class="modal-content" style="background-color: white; border-radius: 12px; padding: 25px; width: 500px; max-width: 90%;">
                <div class="modal-header" style="border-bottom: 2px solid #edf2f7; margin-bottom: 20px; padding-bottom: 15px;">
                  <div class="modal-title" style="font-size: 20px; color: #f44336; font-weight: 600;">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 10px;"></i>
                    Lỗi thanh toán
                  </div>
                  <button class="modal-close" onclick="this.closest('.payment-error-modal').remove()" style="background: none; border: none; font-size: 24px; color: #666; cursor: pointer;">×</button>
                </div>

                <div style="margin: 20px 0;">
                  <div style="background: #ffebee; border: 1px solid #ffcdd2; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #c62828; font-weight: 500;">${messageHtml}</p>
                  </div>

                  <div style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                      <span style="font-weight: 500;">Tổng tiền đã thanh toán:</span>
                      <span style="color: #4caf50; font-weight: 600;">${new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(data.totalPaid)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                      <span style="font-weight: 500;">Tổng tiền cần thanh toán:</span>
                      <span style="color: #2196f3; font-weight: 600;">${new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(data.totalAmount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="font-weight: 500;">Số tiền còn thiếu:</span>
                      <span style="color: #f44336; font-weight: 600;">${new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(data.remainingAmount)}</span>
                    </div>
                  </div>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                  ${actionButtons}
                </div>
              </div>
            `;

            document.body.appendChild(modal);

            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.remove();
              }
            });
          }

          //Dữ liệu cho bảng kit
          let kitList = [];
          let currentPage = 0;
          let totalPages = 1;
          let pageSize = 10;
          let currentFilters = { search: "", status: "" };
          async function fetchKits(page = 0, size = 10, filters = {}) {
            try {
              // Build query parameters for API call
              const queryParams = new URLSearchParams({
                page,
                size,
                ...(filters.search && { search: filters.search }),
                ...(filters.status && { status: filters.status }),
              }).toString();

              // Call API to fetch kit data for staff
              const response = await fetch(`/api/kits/staff?${queryParams}`);
              if (!response.ok) throw new Error("Failed to fetch kit data");

              const data = await response.json();
              console.log('Fetched kit data from API:', data);

              // Update global variables
              kitList = data.content || [];
              currentPage = data.pageable?.pageNumber || page;
              totalPages = data.totalPages || 1;
              pageSize = data.pageable?.pageSize || size;

              console.log('Updated kitList:', kitList);
              console.log('Sample kit item:', kitList[0]);

              // Render the data
              renderKits(kitList);
              renderKitPagination();
            } catch (error) {
              console.error("Error fetching kit data:", error);
              showErrorToast(
                "Could not load kit data. Please try again later."
              );

              // Initialize empty state
              kitList = [];
              renderKits(kitList);
              renderKitPagination();
            }
          }

          // Hàm nhóm dữ liệu theo mã cuộc hẹn
          function groupByAppointment(data) {
            const groupedData = {};

            data.forEach((item) => {
              if (!groupedData[item.appointmentId]) {
                groupedData[item.appointmentId] = {
                  appointmentId: item.appointmentId,
                  customerName: item.customerName,
                  address: item.address,
                  status: item.status,
                  services: [],
                };
              }

              groupedData[item.appointmentId].services.push(item);
            });

            return Object.values(groupedData);
          }



          function renderKits(data) {
            const tbody = document.getElementById("kitTableBody");

            // Nhóm dữ liệu theo mã cuộc hẹn
            const groupedData = groupByAppointment(data);

            tbody.innerHTML = groupedData.length
              ? groupedData
                  .map((appointment, idx) => {

                    return `
                <tr>
                  <td style="padding:12px 8px; border-bottom:1px solid #eee; text-align: left;">${
                    appointment.appointmentId || ""
                  }</td>
                  <td style="padding:12px 8px; border-bottom:1px solid #eee; text-align: left; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" title="${
                    appointment.customerName || "Chưa có thông tin"
                  }">${appointment.customerName || "Chưa có thông tin"}</td>
                  <td style="padding:12px 8px; border-bottom:1px solid #eee; text-align: left; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" title="${
                    appointment.address || ""
                  }">${appointment.address || "Chưa có địa chỉ"}</td>
                  <td style="padding:12px 8px; border-bottom:1px solid #eee; text-align: left;">${renderKitStatus(
                    appointment.status || ""
                  )}</td>
                  <td style="padding:12px 0px; border-bottom:1px solid #eee; text-align: left;">
                    <div style='display: flex; gap: 3px; flex-wrap: nowrap; align-items: center;'>
                      ${
                        appointment.status === "Chưa chọn kit"
                          ? `<button onclick="openMultipleKitSelection('${appointment.appointmentId}')" style="background:#4caf50;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                              <i class='fas fa-check'></i> Chọn kit
                            </button>`
                          : appointment.status === "Chưa gửi"
                          ? `<button onclick="sendKits('${appointment.appointmentId}')" style="background:#2196f3;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                              <i class='fas fa-paper-plane'></i> Gửi kit
                            </button>
                            <button onclick="viewAppointmentServices('${appointment.appointmentId}')" style="background:#e3f2fd;color:#1976d2;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                              <i class='fas fa-eye'></i> Xem
                            </button>`
                          : appointment.status === "Chưa nhận mẫu"
                          ? `<div style="display:flex; gap:6px; margin-bottom:6px;">
                                <button onclick="updateKitStatus('${appointment.appointmentId}', 'Đã nhận mẫu')" style="background:#4caf50;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                                  <i class='fas fa-check-circle'></i> Đã nhận mẫu
                                </button>
                                <button onclick="updateKitStatus('${appointment.appointmentId}', 'Lỗi mẫu')" style="background:#f44336;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;flex:1;white-space:nowrap;">
                                  <i class='fas fa-exclamation-circle'></i> Lỗi mẫu
                                </button>
                                <button onclick="viewAppointmentServices('${appointment.appointmentId}')" style="background:#e3f2fd;color:#1976d2;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;flex:1;white-space:nowrap;">
                                  <i class='fas fa-eye'></i> Xem
                                </button>
                              </div>`
                          : appointment.status === "Đã nhận mẫu"
                          ? `<a href="/staff-appointments" class="btn btn-primary" style="background:#2196f3;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                              <i class='fas fa-list'></i> Danh sách lịch hẹn
                            </a>
                            <button onclick="viewAppointmentServices('${appointment.appointmentId}')" style="background:#e3f2fd;color:#1976d2;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                              <i class='fas fa-eye'></i> Xem
                            </button>`
                          : `<button onclick="viewAppointmentServices('${appointment.appointmentId}')" style="background:#e3f2fd;color:#1976d2;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;white-space:nowrap;">
                                <i class='fas fa-eye'></i> Xem
                              </button>`
                      }
                    </div>
                  </td>
                </tr>
              `;
                  })
                  .join("")
              : `<tr><td colspan="5" style="text-align:center; color:#888; padding:12px;">Không có kit phù hợp</td></tr>`;
          }

          function renderKitPagination() {
            const container = document.getElementById("kitPagination");
            container.innerHTML = "";
            if (totalPages <= 1) return;
            // Prev
            const prevBtn = document.createElement("button");
            prevBtn.innerText = "«";
            prevBtn.className = "btn btn-primary";
            prevBtn.disabled = currentPage === 0;
            prevBtn.onclick = () =>
              fetchKits(currentPage - 1, pageSize, currentFilters);
            container.appendChild(prevBtn);
            // Page numbers
            for (let i = 0; i < totalPages; i++) {
              const pageBtn = document.createElement("button");
              pageBtn.innerText = i + 1;
              pageBtn.className =
                "btn" + (i === currentPage ? " btn-success" : " btn-primary");
              pageBtn.disabled = i === currentPage;
              pageBtn.onclick = () => fetchKits(i, pageSize, currentFilters);
              container.appendChild(pageBtn);
            }
            // Next
            const nextBtn = document.createElement("button");
            nextBtn.innerText = "»";
            nextBtn.className = "btn btn-primary";
            nextBtn.disabled = currentPage === totalPages - 1;
            nextBtn.onclick = () =>
              fetchKits(currentPage + 1, pageSize, currentFilters);
            container.appendChild(nextBtn);
          }

          document
            .getElementById("kitFilterForm")
            .addEventListener("submit", function (e) {
              e.preventDefault();
              const search = document
                .getElementById("searchCombined")
                .value.trim();
              const status = document.getElementById("filterStatus").value;
              currentFilters = { search, status };
              fetchKits(0, pageSize, currentFilters);
            });

          // Hàm reset filter
          function resetKitFilter() {
            // Reset form
            document.getElementById("kitFilterForm").reset();
            // Reset current filters
            currentFilters = { search: "", status: "" };
            // Fetch lại tất cả kit
            fetchKits(0, pageSize, currentFilters);
          }

          // Khi load trang, fetch dữ liệu kit lần đầu
          window.addEventListener("DOMContentLoaded", function () {
            fetchKits();
          });

          function viewKitInfo(idx) {
            const kit = kitList[idx];
            if (!kit) return;
            document.getElementById("view-kit-appointment-id").textContent =
              kit.appointmentId || "";
            document.getElementById("view-kit-service").textContent =
              kit.service || "Chưa xác định";
            document.getElementById("view-kit-code").textContent =
              ""; // Tạm thời comment lại: kit.kitCode || ""
            document.getElementById("view-kit-type").textContent =
              kit.kitType || "Chưa xác định";
            document.getElementById("view-kit-send-date").textContent =
              kit.sendDate ? formatDateDisplay(kit.sendDate) : "Chưa gửi";
            document.getElementById("view-kit-receive-date").textContent =
              kit.receiveDate
                ? formatDateDisplay(kit.receiveDate)
                : "Chưa nhận";
            document.getElementById("view-kit-status").innerHTML =
              renderKitStatus(kit.status);
            document.getElementById("view-kit-note").textContent =
              kit.note || "Không có ghi chú";
            document.getElementById("view-kit-modal").style.display = "flex";
          }

          function closeViewKitModal() {
            document.getElementById("view-kit-modal").style.display = "none";
          }

          function renderKitStatus(status) {
            let color = "#888";
            if (status === "Chưa gửi") color = "#ff9800";
            else if (status === "Đã gửi") color = "#1976d2";
            else if (status === "Đã giao thành công") color = "#ff9800";
            else if (status === "Chưa nhận mẫu") color = "#2196f3";
            else if (status === "Đã nhận mẫu") color = "#4caf50";
            else if (status === "Lỗi mẫu") color = "#f44336";
            return `<span style="color:${color}; font-weight:bold;">${
              status || ""
            }</span>`;
          }

          function formatDateDisplay(dateString) {
            if (!dateString) return "";
            const date = new Date(dateString);
            return date.toLocaleDateString("vi-VN");
          }

          function openKitSelection(idx) {
            const kit = kitList[idx];
            if (!kit) return;
            document.getElementById("select-kit-appointment-id").textContent =
              kit.appointmentId || "";
            document.getElementById("select-kit-customer-name").textContent =
              kit.customerName || "Chưa có thông tin";
            document.getElementById("select-kit-service-name").textContent =
              kit.serviceName || "Chưa xác định";
            document.getElementById("selected-appointment-id").value =
              kit.appointmentId || "";
            document.getElementById("selected-service-id").value =
              kit.serviceId || "";

            // Lấy loại kit phù hợp với dịch vụ đã chọn
            const serviceId = kit.serviceId;
            const kitTypeSelect = document.getElementById("kit-type-selection");
            kitTypeSelect.innerHTML = '<option value="">Đang tải...</option>';
            kitTypeSelect.disabled = true;

            // Gọi API để lấy danh sách loại kit phù hợp với dịch vụ
            fetch(`/api/kits/services/${serviceId}/kit-types`)
              .then((response) => {
                if (!response.ok) {
                  throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
              })
              .then((kitTypes) => {
                if (kitTypes.length === 0) {
                  kitTypeSelect.innerHTML =
                    '<option value="">Không có kit phù hợp cho dịch vụ này</option>';
                } else {
                  kitTypeSelect.innerHTML =
                    '<option value="">Chọn loại kit</option>' +
                    kitTypes
                      .map(
                        (kt) =>
                          `<option value="${kt.id}" data-name="${kt.name}">${kt.name} - ${kt.description}</option>`
                      )
                      .join("");
                }
                kitTypeSelect.disabled = false;
              })
              .catch((error) => {
                console.error("Error fetching kit types:", error);
                kitTypeSelect.innerHTML =
                  '<option value="">Không lấy được loại kit</option>';
                kitTypeSelect.disabled = true;
              });

            document.getElementById("kit-selection-modal").style.display =
              "flex";
          }

          // Toast notification functions (similar to list-kit.html)
          function showSuccessToast(message) {
            const toast = document.createElement("div");
            toast.className = "toast-notification";
            toast.innerHTML = `
          <div class="toast-content">
            <i class="fas fa-check-circle" style="color: #4caf50; margin-right: 8px;"></i>
            ${message}
          </div>
        `;
            document.body.appendChild(toast);
            setTimeout(() => {
              toast.style.opacity = "0";
              setTimeout(() => toast.remove(), 300);
            }, 3000);
          }

          function showErrorToast(message) {
            const toast = document.createElement("div");
            toast.className = "toast-notification toast-error";
            toast.innerHTML = `
          <div class="toast-content">
            <i class="fas fa-times-circle" style="color: #f44336; margin-right: 8px;"></i>
            ${message}
          </div>
        `;
            document.body.appendChild(toast);
            setTimeout(() => {
              toast.style.opacity = "0";
              setTimeout(() => toast.remove(), 300);
            }, 3000);
          }

          function showWarningToast(message) {
            const toast = document.createElement("div");
            toast.className = "toast-notification toast-warning";
            toast.innerHTML = `
          <div class="toast-content">
            <i class="fas fa-exclamation-triangle" style="color: #ff9800; margin-right: 8px;"></i>
            ${message}
          </div>
        `;
            document.body.appendChild(toast);
            setTimeout(() => {
              toast.style.opacity = "0";
              setTimeout(() => toast.remove(), 300);
            }, 3000);
          }

          function confirmSendKitWithWarning(appointmentId) {
            console.log('confirmSendKitWithWarning called with appointmentId:', appointmentId);
            // Remove the warning modal immediately to prevent spam
            const warningModal = document.querySelector('.payment-warning-modal');
            if (warningModal) warningModal.remove();

            fetch(`/api/kits/appointment/${appointmentId}/send`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                sendDate: new Date().toISOString().split("T")[0],
                confirm: true
              }),
            })
              .then((response) => {
                console.log('Response status:', response.status);
                if (response.status === 409) {
                  response.json().then(data => {
                    showErrorToast(data.message || 'Không thể gửi kit do cảnh báo thanh toán.');
                  });
                  return;
                }
                if (!response.ok) {
                  response.text().then(errorMessage => {
                    showErrorToast(errorMessage || 'Có lỗi xảy ra khi gửi kit.');
                  });
                  return;
                }
                showSuccessToast('Gửi kit thành công!');
                setTimeout(() => window.location.reload(), 1000);
              })
              .catch((error) => {
                showErrorToast('Có lỗi xảy ra khi gửi kit: ' + (error.message || ''));
              });
          }

          function showAddPaymentModal(appointmentId) {
            // Tìm booking trong kitList
            const booking = kitList.find(item => String(item.appointmentId) === String(appointmentId));
            if (!booking) {
              showErrorToast('Không tìm thấy thông tin booking!');
              return;
            }
            window.openAddPaymentModal({
              booking: {
                id: booking.appointmentId,
                customerName: booking.customerName,
                remainingAmount: booking.remainingAmount,
                paymentMethod: booking.paymentMethod,
                method: booking.method
              }
            });
          }
        </script>
      </div>
    </div>

    <!-- Đảm bảo các script khởi tạo menu/toast nằm trước thẻ đóng -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (window.renderStaffSidebarInfo) window.renderStaffSidebarInfo();
        if (typeof initializeMenu === 'function') initializeMenu();
      });
    </script>
    <script src="/assets/js/staff-api.js"></script>
    <script src="/assets/js/staff-main.js"></script>
    <script src="/assets/js/staff-modal-utils.js"></script>
</body>
</html>
