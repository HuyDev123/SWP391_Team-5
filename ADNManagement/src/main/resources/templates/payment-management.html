<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý thanh toán - Dịch Vụ Xét Nghiệm ADN</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <!-- CSS chính -->
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <!-- CSS header và footer -->
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link rel="stylesheet" href="/assets/css/user-dropdown.css" />
    <style>
      body {
        display: flex;
        min-height: 100vh;
        background-color: #f5f5f5;
      }

      .text-container {
        display: flex;
        flex-direction: column;
      }

      #logout-btn.logout-btn i {
        margin-right: 8px;
        font-size: 18px;
      }
      .menu-title {
        padding: 20px 20px 10px 20px;
        color: #666;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        position: relative;
      }

      .menu-title::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 20px;
        width: 30px;
        height: 2px;
        background: linear-gradient(90deg, #2196f3, #64b5f6);
        border-radius: 1px;
      }

      #mainMenu {
        padding: 10px 15px;
      }

      .menu-item {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
        border-radius: 12px;
        margin-bottom: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }

      .menu-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(33, 150, 243, 0.1),
          transparent
        );
        transition: left 0.6s ease;
      }

      .menu-item:hover::before {
        left: 100%;
      }

      .menu-item:hover {
        background: linear-gradient(
          135deg,
          rgba(33, 150, 243, 0.1),
          rgba(33, 150, 243, 0.05)
        );
        color: #2196f3;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
      }

      .menu-item.active {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      .menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 14px;
        border-radius: 10px;
        background: linear-gradient(
          135deg,
          rgba(33, 150, 243, 0.15),
          rgba(33, 150, 243, 0.08)
        );
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
      }

      .menu-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.3),
          transparent 70%
        );
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0.7)
        );
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
      }

      .menu-item:hover .menu-icon::after {
        width: 30px;
        height: 30px;
      }

      .menu-item.active .menu-icon {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.1)
        );
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .menu-icon i {
        font-size: 18px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1;
        position: relative;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.2);
        color: #2196f3;
      }

      .menu-item.active .menu-icon i {
        color: white;
        transform: scale(1.1);
      }

      @media (max-width: 600px) {
        #logout-btn.logout-btn {
          width: 100%;
          font-size: 15px;
          padding: 10px 0;
        }
        .user-info {
          flex-direction: column;
          gap: 10px;
        }
        .user-details {
          text-align: center;
        }
      }

      /* Login buttons */
      .login-buttons {
        display: flex;
        flex-direction: column;
        width: 100%;
        gap: 10px;
      }

      .google-login-btn,
      .demo-login-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        border: none;
      }

      .google-login-btn {
        background-color: white;
        color: #757575;
        border: 1px solid #dadce0;
      }

      .google-login-btn:hover {
        background-color: #f5f5f5;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .google-login-btn i {
        margin-right: 10px;
        color: #4285f4;
        font-size: 18px;
      }

      .demo-login-btn {
        background-color: #1976d2;
        color: white;
      }

      .demo-login-btn:hover {
        background-color: #1565c0;
      }

      .demo-login-btn i {
        margin-right: 10px;
      }

      /* Demo accounts dropdown */
      .demo-accounts-dropdown {
        position: absolute;
        top: 100%;
        left: 20px;
        right: 20px;
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        z-index: 100;
        overflow: hidden;
      }

      .demo-account-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .demo-account-item:hover {
        background-color: #f5f5f5;
      }

      .demo-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        color: white;
        font-weight: 500;
      }

      .demo-info {
        display: flex;
        flex-direction: column;
      }

      .demo-name {
        font-size: 14px;
        font-weight: 500;
      }

      .demo-role {
        font-size: 12px;
        color: #666;
      } /* Main content styles */
      .main-content {
        margin-left: 280px;
        padding: 25px;
        width: calc(100% - 280px);
        min-height: 100vh;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }

      .navbar {
        display: flex;
        margin: 20px 0;
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        padding: 15px 20px;
        text-decoration: none;
        color: #333;
        display: flex;
        align-items: center;
        border-bottom: 2px solid transparent;
      }

      .nav-item.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .nav-icon {
        margin-right: 10px;
      }

      /* Sample collection styles */
      .sample-header {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("assets/images/banner.jpg");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 60px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
      }

      .sample-header h1 {
        font-size: 32px;
        margin-bottom: 15px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }

      .sample-header p {
        font-size: 18px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .instruction-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .instruction-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .warning-box {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 5px 5px 0;
      }

      .warning-title {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e65100;
      }

      .warning-icon {
        margin-right: 10px;
        font-size: 20px;
      }

      .steps-container {
        margin-top: 30px;
      }

      .step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
      }

      .step-number {
        width: 50px;
        height: 50px;
        background-color: #2196f3;
        color: white;
        font-size: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 20px;
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
      }

      .step-description {
        color: #555;
        line-height: 1.6;
      }

      .step-image {
        width: 100%;
        max-width: 300px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-timeline {
        position: absolute;
        left: 24px;
        top: 50px;
        bottom: -30px;
        width: 2px;
        background-color: #2196f3;
      }

      .step:last-child .step-timeline {
        display: none;
      }

      .step-tip {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .step-tip-title {
        font-weight: bold;
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        color: #0d47a1;
      }

      .step-tip-icon {
        margin-right: 8px;
      }

      .step-bullet-list {
        margin-top: 15px;
        margin-left: 5px;
        list-style-type: none;
      }

      .step-bullet-list li {
        position: relative;
        padding-left: 28px;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .step-bullet-list li:before {
        content: "•";
        position: absolute;
        left: 0;
        top: 0;
        color: #2196f3;
        font-size: 24px;
        line-height: 1;
      }

      .step-image-container {
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .step-image-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .step-image {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 8px;
      }

      .step-content {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .step-text {
        flex: 1;
        min-width: 300px;
      }

      .step-visual {
        flex: 1;
        min-width: 300px;
        padding-left: 20px;
        display: flex;
        justify-content: center;
      }
      .sample-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .sample-type {
        flex: 1;
        min-width: 250px;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
      }
      .sample-type:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .step-content {
          flex-direction: column;
        }

        .step-visual {
          padding-left: 0;
          margin-top: 20px;
          width: 100%;
        }
      }
      .sample-type-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: center;
      }

      .sample-type-icon {
        margin-right: 10px;
        color: #2196f3;
        font-size: 20px;
      }

      .sample-type-content {
        color: #555;
        line-height: 1.5;
      }

      /* Video section */
      .video-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .video-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
      }

      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* FAQs section */
      .faq-section {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .faq-title {
        font-size: 24px;
        color: #2196f3;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .faq-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .faq-question {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: flex;
        align-items: flex-start;
      }

      .question-icon {
        color: #2196f3;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .faq-answer {
        color: #555;
        line-height: 1.6;
        padding-left: 30px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .step {
          flex-direction: column;
        }

        .step-number {
          margin-bottom: 15px;
          margin-right: 0;
        }

        .step-timeline {
          display: none;
        }
      }
      .highlighted-step {
        animation: highlight-step 3s ease;
      }

      @keyframes highlight-step {
        0%,
        100% {
          background-color: transparent;
        }
        20%,
        80% {
          background-color: rgba(33, 150, 243, 0.1);
          box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
          transform: translateY(-5px);
        }
      }

      /* Đảm bảo các bước có đủ padding cho hiệu ứng */
      .step {
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }
      .menu-icon i {
        font-size: 18px;
        width: 20px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .menu-item.active .menu-icon i {
        color: white;
      }

      .menu-item:hover .menu-icon i {
        transform: scale(1.1);
        color: #2196f3;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #2196f3;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1976d2;
      }

      /* CSS chung cho các modal để đảm bảo hiển thị tốt trên mọi thiết bị */
      .modal-container {
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Căn lề trên để dễ cuộn */
        padding: 20px 0;
      }

      /* Style chung cho iframe trong modal */
      .modal-iframe {
        background-color: white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        width: 100%;
        height: 85vh;
        max-height: calc(100vh - 60px);
        overflow: auto;
      }

      /* Kiểu hiển thị nút close */
      .modal-close-btn {
        position: fixed;
        top: 15px;
        right: 15px;
        z-index: 10002;
        background: white;
        color: #f44336;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.2s;
      }

      .modal-close-btn:hover {
        transform: scale(1.1);
        background: #ffebee;
      }

      /* Styling cho backdrop */
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(3px);
        z-index: 10000;
      }

      .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .status-booked {
        background-color: rgba(33, 150, 243, 0.1);
        color: #2196f3;
      }

      .status-waiting {
        background-color: rgba(255, 152, 0, 0.1);
        color: #ff9800;
      }

      .status-received {
        background-color: rgba(25, 118, 210, 0.1);
        color: #1976d2;
      }

      .status-completed {
        background-color: rgba(76, 175, 80, 0.1);
        color: #4caf50;
      }

      .status-delivered {
        background-color: rgba(0, 150, 136, 0.1);
        color: #009688;
      }

      .status-cancelled {
        background-color: rgba(244, 67, 54, 0.1);
        color: #f44336;
      }

      /* CSS cho các trạng thái mới */
      .status-kit-pending {
        background-color: rgba(255, 193, 7, 0.1);
        color: #ffc107;
      }

      .status-kit-received {
        background-color: rgba(156, 39, 176, 0.1);
        color: #9c27b0;
      }

      .status-kit-returned {
        background-color: rgba(63, 81, 181, 0.1);
        color: #3f51b5;
      }

      .status-not-sampled {
        background-color: rgba(3, 169, 244, 0.1);
        color: #03a9f4;
      }

      .status-sampling-completed {
        background-color: rgba(139, 195, 74, 0.1);
        color: #8bc34a;
      }

      .status-sample-error {
        background-color: rgba(255, 87, 34, 0.1);
        color: #ff5722;
      }

      .status-final-completed {
        background-color: rgba(76, 175, 80, 0.1);
        color: #4caf50;
      }

      .btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: none;
        cursor: pointer;
      }

      .btn-primary {
        background: linear-gradient(45deg, #2196f3, #1976d2);
        color: white;
      }

      .btn-success {
        background: linear-gradient(45deg, #4caf50, #388e3c);
        color: white;
      }
    </style>
    <!-- Thêm vào phần <head> của mỗi trang -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <style>
      /* Hiệu ứng chuyển động mượt mà */
      .hero-banner,
      .content-section,
      .service-card,
      .step-item,
      .contact-btn {
        transition: all 0.5s ease;
      }

      /* Cải thiện hero banner */
      .hero-banner {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .hero-banner:hover {
        transform: translateY(-5px);
      }

      /* Hiệu ứng cho các section */
      .content-section {
        transition: transform 0.4s ease, box-shadow 0.4s ease;
      }

      .content-section:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      }

      /* Hiệu ứng facility items */
      .facility-item {
        transition: all 0.4s ease;
      }

      .facility-item:hover {
        transform: translateY(-8px);
      }

      .facility-item .icon-wrapper {
        transition: all 0.5s ease;
      }

      .facility-item:hover .icon-wrapper {
        transform: rotateY(180deg);
      }

      /* Card hover effects */
      .service-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 30px rgba(33, 150, 243, 0.1);
      }

      .service-card .card-icon {
        transition: all 0.5s ease;
      }

      .service-card:hover .card-icon {
        transform: rotateY(360deg);
        background-color: #2196f3;
        color: white;
      }

      /* Step item animations */
      .step-item {
        position: relative;
        overflow: hidden;
      }

      .step-item:hover {
        background-color: #f9f9f9;
        padding-left: 15px;
        border-radius: 8px;
      }

      .step-item .step-number,
      .step-item .step-icon {
        transition: all 0.4s ease;
      }

      .step-item:hover .step-number {
        transform: scale(1.2);
      }

      .step-item:hover .step-icon {
        transform: rotate(360deg);
      }

      /* Contact button effects */
      .contact-btn {
        transform-origin: center;
        transition: all 0.3s ease;
      }

      .contact-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      }

      .contact-btn i {
        transition: all 0.4s ease;
      }

      .contact-btn:hover i {
        transform: scale(1.2);
      }

      /* Sidebar menu hover effect */
      .menu-item {
        transition: all 0.3s ease;
      }

      .menu-item:hover .menu-icon {
        transform: scale(1.2);
        transition: transform 0.3s ease;
      }

      /* Gradient buttons */
      .login-register-btn {
        background-image: linear-gradient(45deg, #2196f3, #1976d2);
        transition: all 0.3s ease;
      }

      .login-register-btn:hover {
        background-image: linear-gradient(45deg, #1976d2, #0d47a1);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
      }

      /* Animation for facility section */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      /* Specific styles for the filter form that won't be affected by global styles */
      .genx-filter-form {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 16px !important;
        align-items: center !important;
        margin-bottom: 20px !important;
        flex-direction: row !important; /* Override the column direction from global styles */
      }

      .genx-filter-form div {
        margin: 0 !important;
      }

      .genx-filter-form input,
      .genx-filter-form select {
        padding: 6px 10px !important;
        border: 1px solid #ccc !important;
        border-radius: 4px !important;
      }

      .genx-filter-form button[type="submit"] {
        background: #2196f3 !important;
        color: white !important;
        border: none !important;
        border-radius: 4px !important;
        padding: 8px 18px !important;
        cursor: pointer !important;
      }

      .genx-filter-form button[type="reset"] {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd !important;
        border-radius: 4px !important;
        padding: 8px 18px !important;
        cursor: pointer !important;
        margin-left: 8px !important;
      }

      /* Styles for payment management */
      .tab-item {
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .tab-item:hover {
        color: #2196f3;
      }

      .tab-item.active {
        color: #2196f3;
        font-weight: 500;
      }

      .tab-item.active:after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #2196f3;
      }

      .toast-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        z-index: 1000;
      }

      .toast-content {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #333;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      /* Modal Animation */
      .modal-container {
        animation: fadeIn 0.3s ease-out;
      }

      .modal-content {
        animation: slideUp 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Responsive Styles */
      @media (max-width: 768px) {
        .tab-header {
          flex-direction: column;
        }

        .tab-item {
          width: 100%;
          margin-bottom: 10px;
        }

        .genx-filter-form {
          flex-direction: column !important;
          align-items: flex-start !important;
        }

        .genx-filter-form > div {
          width: 100%;
          max-width: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <script th:inline="javascript">
      /*<![CDATA[*/
      window.serverStaff = /*[[${staffData}]]*/ null;
      /*]]>*/
    </script>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo-container">
        <img src="/assets/images/logo.png" alt="Logo" class="logo" />
        <div class="text-container">
          <div class="logo-text">Genx</div>
          <div class="logo-subtext">Trung tâm xét nghiệm ADN huyết thống</div>
        </div>
      </div>
      <div class="login-register" id="login-register">
        <div id="user-info-container"></div>
      </div>
      <div class="menu-title">MAIN MENU</div>
      <div id="mainMenu">
        <!-- <a href="/staff-home" class="menu-item">
          <span class="menu-icon"><i class="fas fa-home"></i></span>
          Trang chủ
        </a>

        <a href="/staff-appointments" class="menu-item">
          <span class="menu-icon"><i class="fas fa-clipboard-list"></i></span>
          Danh sách lịch hẹn
        </a>

        <a href="/staff-kit-list" class="menu-item">
          <span class="menu-icon"><i class="fas fa-vials"></i></span>
          Danh sách kit xét nghiệm
        </a>

        <a href="/staff-participants" class="menu-item">
          <span class="menu-icon"><i class="fas fa-users"></i></span>
          Quản lý người tham gia
        </a>

        <a href="/staff-samples" class="menu-item">
          <span class="menu-icon"><i class="fas fa-flask"></i></span>
          Quản lý mẫu xét nghiệm
        </a>

        <a href="/staff-results" class="menu-item">
          <span class="menu-icon"><i class="fas fa-chart-line"></i></span>
          Quản lý kết quả xét nghiệm
        </a> -->

        <!-- <a href="/feedback-manage" class="menu-item">
          <span class="menu-icon"><i class="fas fa-dollar-sign"></i></span>
          Quản lý giá dịch vụ
        </a> -->

        <a href="/payment-management" class="menu-item active">
          <span class="menu-icon"><i class="fas fa-money-bill-wave"></i></span>
          Quản lý thanh toán
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Navigation Bar -->
      <div id="topNavbar" class="navbar">
        <!-- Navbar sẽ được thêm bằng JavaScript -->
      </div>
      <!-- Phần cần code -->
      <!-- ...existing code... -->
      <div class="instruction-container" style="margin-top: 10px">
        <div class="instruction-title">
          <i class="fas fa-money-bill-wave" style="color: #2196f3"></i>
          Quản lý thanh toán
          <div style="font-size: 14px; color: #666; margin-top: 5px">
            <i class="fas fa-info-circle"></i> Xử lý các thanh toán từ khách
            hàng và xem lịch sử thanh toán
          </div>
        </div>

        <!-- Login Required Message -->
        <div
          id="login-required-message"
          style="
            display: none;
            text-align: center;
            padding: 30px;
            margin: 20px 0;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
          "
        >
          <i
            class="fas fa-lock"
            style="font-size: 36px; color: #2196f3; margin-bottom: 15px"
          ></i>
          <h3 style="font-size: 18px; margin-bottom: 10px">
            Yêu cầu đăng nhập
          </h3>
          <p style="color: #666; margin-bottom: 20px">
            Bạn cần đăng nhập để xem thông tin thanh toán
          </p>
          <a
            href="/login"
            class="btn btn-primary"
            style="
              display: inline-flex;
              align-items: center;
              padding: 8px 16px;
              background: #2196f3;
              color: white;
              text-decoration: none;
              border-radius: 4px;
              font-weight: 500;
            "
          >
            <i class="fas fa-sign-in-alt" style="margin-right: 8px"></i> Đăng
            nhập
          </a>
        </div>

        <!-- Payment Content Container -->
        <div id="payment-content-container">
          <!-- Tabs for Payment Management -->
          <div class="payment-tabs" style="margin-bottom: 20px">
            <div
              class="tab-header"
              style="
                display: flex;
                border-bottom: 1px solid #e0e0e0;
                margin-bottom: 20px;
              "
            >
              <div
                id="tab-pending"
                class="tab-item active"
                onclick="switchTab('pending')"
                style="
                  padding: 12px 20px;
                  cursor: pointer;
                  font-weight: 500;
                  border-bottom: 2px solid #2196f3;
                  color: #2196f3;
                  margin-right: 15px;
                "
              >
                <i class="fas fa-clock" style="margin-right: 8px"></i>
                Thanh toán chờ xử lý
              </div>
              <div
                id="tab-history"
                class="tab-item"
                onclick="switchTab('history')"
                style="
                  padding: 12px 20px;
                  cursor: pointer;
                  font-weight: 500;
                  border-bottom: 2px solid transparent;
                  color: #666;
                  margin-right: 15px;
                "
              >
                <i class="fas fa-history" style="margin-right: 8px"></i>
                Lịch sử thanh toán
              </div>
            </div>

            <!-- Tab Content - Pending Payments -->
            <div
              id="content-pending"
              class="tab-content"
              style="display: block"
            >
              <!-- Filter Form for Pending Payments -->
              <form
                id="pendingFilterForm"
                class="genx-filter-form"
                style="
                  display: flex;
                  flex-wrap: wrap;
                  gap: 16px;
                  align-items: center;
                  margin-bottom: 20px;
                "
              >
                <div style="flex-grow: 1; max-width: 500px">
                  <label
                    for="pendingSearchFilter"
                    style="font-weight: 500; color: #333"
                    >Tìm kiếm:</label
                  >
                  <div style="display: flex; align-items: center">
                    <input
                      type="text"
                      id="pendingSearchFilter"
                      name="pendingSearchFilter"
                      placeholder="Mã thanh toán, Tên khách hàng,..."
                      style="
                        padding: 8px 12px;
                        border: 1px solid #ccc;
                        border-radius: 4px 0 0 4px;
                        width: 100%;
                      "
                    />
                    <button
                      type="submit"
                      style="
                        background: #2196f3;
                        color: white;
                        border: none;
                        border-radius: 0 4px 4px 0;
                        padding: 8px 16px;
                        cursor: pointer;
                        height: 37px;
                      "
                    >
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
                <div
                  style="
                    text-align: right;
                    margin-left: auto;
                    display: flex;
                    align-items: flex-end;
                  "
                >
                  <button
                    type="button"
                    class="btn btn-primary"
                    onclick="openAddPaymentModal()"
                    style="
                      display: inline-flex;
                      align-items: center;
                      height: 37px;
                      padding: 0 16px;
                      background: #2196f3;
                      color: white;
                      border: none;
                      border-radius: 4px;
                      cursor: pointer;
                      font-weight: 500;
                      box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
                      margin-top: 27px;
                    "
                  >
                    <i class="fas fa-plus" style="margin-right: 8px"></i> Thêm
                    thanh toán mới
                  </button>
                </div>
              </form>

              <!-- Pending Payments Table -->
              <div style="overflow-x: auto">
                <table
                  style="
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 10px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                    border-radius: 8px;
                    overflow: hidden;
                    margin-bottom: 20px;
                  "
                >
                  <thead>
                    <tr style="background: #e3f2fd; height: 50px">
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 8%;
                        "
                      >
                        Mã TT
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: left;
                          width: 10%;
                        "
                      >
                        Mã lịch hẹn
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: left;
                          width: 15%;
                        "
                      >
                        Khách hàng
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 12%;
                        "
                      >
                        Ngày tạo
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 12%;
                        "
                      >
                        Số tiền
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 15%;
                        "
                      >
                        Phương thức
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 20%;
                        "
                      >
                        Thao tác
                      </th>
                    </tr>
                  </thead>
                  <tbody id="pendingPaymentsTableBody">
                    <!-- Data will be rendered by JS -->
                  </tbody>
                </table>
              </div>

              <!-- Pagination for Pending Payments -->
              <div
                id="pendingPagination"
                class="pagination"
                style="display: flex; justify-content: center; margin-top: 20px"
              >
                <!-- Pagination will be rendered by JS -->
              </div>
            </div>

            <!-- Tab Content - Payment History -->
            <div id="content-history" class="tab-content" style="display: none">
              <!-- Search for Payment History -->
              <form
                id="historySearchForm"
                class="genx-search-form"
                style="
                  display: flex;
                  flex-wrap: wrap;
                  gap: 16px;
                  align-items: flex-start;
                  justify-content: flex-start;
                  margin-bottom: 16px;
                  padding: 15px;
                  background-color: #f9f9f9;
                  border-radius: 6px;
                  border: 1px solid #eee;
                "
              >
                <div style="flex-grow: 1; max-width: 500px">
                  <label
                    for="historySearchFilter"
                    style="
                      font-weight: 500;
                      color: #333;
                      display: block;
                      margin-bottom: 6px;
                    "
                    >Tìm kiếm:</label
                  >
                  <div style="display: flex; align-items: center">
                    <input
                      type="text"
                      id="historySearchFilter"
                      name="historySearchFilter"
                      placeholder="Mã thanh toán, Tên khách hàng,..."
                      style="
                        padding: 8px 12px;
                        border: 1px solid #ccc;
                        border-radius: 4px 0 0 4px;
                        width: 100%;
                      "
                    />
                    <button
                      type="submit"
                      style="
                        background: #2196f3;
                        color: white;
                        border: none;
                        border-radius: 0 4px 4px 0;
                        padding: 8px 16px;
                        cursor: pointer;
                        height: 37px;
                      "
                    >
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>

              <!-- Filter Form for Payment History -->
              <form
                id="historyFilterForm"
                class="genx-filter-form"
                style="
                  display: flex;
                  flex-wrap: wrap;
                  gap: 16px;
                  align-items: flex-start;
                  justify-content: flex-start;
                  margin-bottom: 20px;
                  padding: 15px;
                  background-color: #f9f9f9;
                  border-radius: 6px;
                  border: 1px solid #eee;
                "
              >
                <div style="flex-grow: 1; max-width: 200px">
                  <label
                    for="dateFilter"
                    style="
                      font-weight: 500;
                      color: #333;
                      display: block;
                      margin-bottom: 6px;
                    "
                    >Ngày thanh toán:</label
                  >
                  <input
                    type="date"
                    id="dateFilter"
                    name="dateFilter"
                    style="
                      padding: 8px 12px;
                      border: 1px solid #ccc;
                      border-radius: 4px;
                      width: 100%;
                    "
                  />
                </div>

                <div style="flex-grow: 1; max-width: 200px">
                  <label
                    for="paymentMethodFilter"
                    style="
                      font-weight: 500;
                      color: #333;
                      display: block;
                      margin-bottom: 6px;
                    "
                    >Phương thức:</label
                  >
                  <select
                    id="paymentMethodFilter"
                    name="paymentMethodFilter"
                    style="
                      padding: 8px 12px;
                      border: 1px solid #ccc;
                      border-radius: 4px;
                      width: 100%;
                    "
                  >
                    <option value="">Tất cả</option>
                    <option value="CASH">Tiền mặt</option>
                    <option value="BANKING">Chuyển khoản</option>
                    <option value="COD">COD</option>
                  </select>
                </div>

                <div style="align-self: flex-end; margin-top: 21px">
                  <button
                    type="submit"
                    class="btn btn-primary"
                    style="display: inline-flex; align-items: center"
                  >
                    <i class="fas fa-filter" style="margin-right: 5px"></i> Lọc
                  </button>
                </div>
              </form>

              <!-- Payment History Table -->
              <div style="overflow-x: auto">
                <table
                  style="
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 10px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                    border-radius: 8px;
                    overflow: hidden;
                    margin-bottom: 20px;
                  "
                >
                  <thead>
                    <tr style="background: #e3f2fd; height: 50px">
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 8%;
                        "
                      >
                        Mã TT
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: left;
                          width: 10%;
                        "
                      >
                        Mã lịch hẹn
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: left;
                          width: 15%;
                        "
                      >
                        Khách hàng
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 12%;
                        "
                      >
                        Ngày thanh toán
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 12%;
                        "
                      >
                        Số tiền
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 15%;
                        "
                      >
                        Phương thức
                      </th>
                      <th
                        style="
                          padding: 12px 8px;
                          border-bottom: 1px solid #eee;
                          text-align: center;
                          width: 20%;
                        "
                      >
                        Thao tác
                      </th>
                    </tr>
                  </thead>
                  <tbody id="historyPaymentsTableBody">
                    <!-- Data will be rendered by JS -->
                  </tbody>
                </table>
              </div>

              <!-- Pagination for Payment History -->
              <div
                id="historyPagination"
                class="pagination"
                style="display: flex; justify-content: center; margin-top: 20px"
              >
                <!-- Pagination will be rendered by JS -->
              </div>
            </div>
          </div>
        </div>
        <!-- Close payment-content-container -->
      </div>
      <script>
        // Lưu trữ dữ liệu thanh toán
        let pendingPayments = []; // Dữ liệu thanh toán chờ xử lý
        let historyPayments = []; // Dữ liệu lịch sử thanh toán
        let isAuthenticated = false; // Trạng thái đăng nhập

        // API endpoint gốc - thay đổi theo cấu hình của bạn
        const API_BASE_URL = "/api";

        // Cấu hình phân trang
        let currentPendingPage = 0;
        let currentHistoryPage = 0;
        const pageSize = 10;

        // Filters
        let pendingFilters = {
          searchQuery: "",
        };

        let historyFilters = {
          searchQuery: "",
          specificDate: "",
          paymentMethod: "",
        };

        // Kiểm tra trạng thái đăng nhập
        async function checkAuthentication() {
          if (isAuthenticated) {
            return true;
          }

          try {
            const response = await fetch(`${API_BASE_URL}/auth/status`);
            if (response.ok) {
              const data = await response.json();
              isAuthenticated = data.authenticated || false;
              return isAuthenticated;
            }
            return false;
          } catch (error) {
            console.error("Lỗi kiểm tra đăng nhập:", error);
            return false;
          }
        }

        // Cập nhật trạng thái đăng nhập
        function setAuthenticated(status) {
          isAuthenticated = status;
          if (!status) {
            document.getElementById("payment-content-container").style.display =
              "none";
            document.getElementById("login-required-message").style.display =
              "block";
          } else {
            document.getElementById("payment-content-container").style.display =
              "block";
            document.getElementById("login-required-message").style.display =
              "none";
          }
        }

        // Hàm chuyển tab
        function switchTab(tabName) {
          // Ẩn tất cả tab content
          document.querySelectorAll(".tab-content").forEach((content) => {
            content.style.display = "none";
          });

          // Xóa trạng thái active của tất cả tab
          document.querySelectorAll(".tab-item").forEach((tab) => {
            tab.style.borderBottom = "2px solid transparent";
            tab.style.color = "#666";
          });

          // Hiển thị tab được chọn
          document.getElementById(`content-${tabName}`).style.display = "block";

          // Cập nhật trạng thái active của tab
          const activeTab = document.getElementById(`tab-${tabName}`);
          activeTab.style.borderBottom = "2px solid #2196f3";
          activeTab.style.color = "#2196f3";

          // Tải dữ liệu tương ứng
          if (tabName === "pending") {
            fetchPendingPayments(currentPendingPage, pageSize, pendingFilters);
          } else if (tabName === "history") {
            fetchHistoryPayments(currentHistoryPage, pageSize, historyFilters);
          }
        }

        // Hàm tạo ID duy nhất
        function generateUniqueId(prefix) {
          return prefix + "_" + Math.random().toString(36).substr(2, 9);
        }

        // Hàm lấy dữ liệu thanh toán chờ xử lý
        function fetchPendingPayments(page = 0, size = 10, filters = {}) {
          currentPendingPage = page;

          // Kiểm tra trạng thái đăng nhập
          checkAuthentication().then((auth) => {
            if (!auth) {
              // Nếu chưa đăng nhập, hiển thị thông báo yêu cầu đăng nhập
              document.getElementById(
                "payment-content-container"
              ).style.display = "none";
              document.getElementById("login-required-message").style.display =
                "block";
              return;
            }

            document.getElementById("payment-content-container").style.display =
              "block";
            document.getElementById("login-required-message").style.display =
              "none";

            // Xây dựng tham số truy vấn
            const queryParams = new URLSearchParams();
            queryParams.append("page", page);
            queryParams.append("size", size);

            if (filters.searchQuery) {
              queryParams.append("search", filters.searchQuery);
            }

            // Gọi API để lấy dữ liệu
            fetch(`${API_BASE_URL}/payments/pending?${queryParams.toString()}`)
              .then((response) => {
                if (!response.ok) {
                  if (response.status === 401) {
                    // Xử lý lỗi xác thực
                    setAuthenticated(false);
                    throw new Error("Yêu cầu đăng nhập");
                  }
                  throw new Error("Lỗi khi tải dữ liệu");
                }
                return response.json();
              })
              .then((data) => {
                pendingPayments = data.content || [];
                const totalPages = data.totalPages || 1;

                // Render dữ liệu
                renderPendingPayments(pendingPayments);
                renderPendingPagination(page, totalPages);
              })
              .catch((error) => {
                console.error(
                  "Lỗi khi tải dữ liệu thanh toán chờ xử lý:",
                  error
                );
                // Hiển thị lỗi trên giao diện nếu cần
                renderPendingPayments([]);
                renderPendingPagination(0, 1);
              });
          });
        }

        // Hàm lấy dữ liệu lịch sử thanh toán
        function fetchHistoryPayments(page = 0, size = 10, filters = {}) {
          currentHistoryPage = page;

          // Kiểm tra trạng thái đăng nhập
          checkAuthentication().then((auth) => {
            if (!auth) {
              // Nếu chưa đăng nhập, hiển thị thông báo yêu cầu đăng nhập
              document.getElementById(
                "payment-content-container"
              ).style.display = "none";
              document.getElementById("login-required-message").style.display =
                "block";
              return;
            }

            document.getElementById("payment-content-container").style.display =
              "block";
            document.getElementById("login-required-message").style.display =
              "none";

            // Xây dựng tham số truy vấn
            const queryParams = new URLSearchParams();
            queryParams.append("page", page);
            queryParams.append("size", size);

            if (filters.searchQuery) {
              queryParams.append("search", filters.searchQuery);
            }

            if (filters.specificDate) {
              queryParams.append("date", filters.specificDate);
            }

            if (filters.paymentMethod) {
              queryParams.append("method", filters.paymentMethod);
            }

            // Gọi API để lấy dữ liệu
            fetch(`${API_BASE_URL}/payments/history?${queryParams.toString()}`)
              .then((response) => {
                if (!response.ok) {
                  if (response.status === 401) {
                    // Xử lý lỗi xác thực
                    setAuthenticated(false);
                    throw new Error("Yêu cầu đăng nhập");
                  }
                  throw new Error("Lỗi khi tải dữ liệu");
                }
                return response.json();
              })
              .then((data) => {
                historyPayments = data.content || [];
                const totalPages = data.totalPages || 1;

                // Render dữ liệu
                renderHistoryPayments(historyPayments);
                renderHistoryPagination(page, totalPages);
              })
              .catch((error) => {
                console.error("Lỗi khi tải dữ liệu lịch sử thanh toán:", error);
                // Hiển thị lỗi trên giao diện nếu cần
                renderHistoryPayments([]);
                renderHistoryPagination(0, 1);
              });
          });
        }

        // Hàm render thanh toán chờ xử lý
        function renderPendingPayments(payments) {
          const tableBody = document.getElementById("pendingPaymentsTableBody");

          if (!tableBody) {
            console.error("Table body element not found!");
            return;
          }

          if (!payments || payments.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                  <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px; color: #2196f3;"></i>
                  <p>Không có thanh toán nào đang chờ xử lý.</p>
                </td>
              </tr>
            `;
            return;
          }

          let html = "";

          payments.forEach((payment) => {
            const formattedAmount = new Intl.NumberFormat("vi-VN", {
              style: "currency",
              currency: "VND",
            }).format(payment.amount);
            const formattedDate = new Date(
              payment.requestDate
            ).toLocaleDateString("vi-VN");

            html += `
              <tr style="border-bottom: 1px solid #f0f0f0; height: 50px; background: white;">
                <td style="padding: 12px 8px; text-align: center; font-weight: 500;">${
                  payment.id
                }</td>
                <td style="padding: 12px 8px; text-align: left;">${
                  payment.bookingId
                }</td>
                <td style="padding: 12px 8px; text-align: left;">${
                  payment.customerName
                }</td>
                <td style="padding: 12px 8px; text-align: center;">${formattedDate}</td>
                <td style="padding: 12px 8px; text-align: right;">${formattedAmount}</td>
                <td style="padding: 12px 8px; text-align: center;">${renderPaymentMethod(
                  payment.paymentMethod
                )}</td>
                <td style="padding: 12px 8px; text-align: center;">
                  <div style="display: flex; justify-content: center; gap: 5px;">
                    <button onclick="confirmPayment('${
                      payment.id
                    }')" class="btn btn-primary" style="padding: 6px 10px;" title="Xác nhận thanh toán">
                      <i class="fas fa-check"></i>
                    </button>
                    <button onclick="viewPaymentDetails('${
                      payment.id
                    }')" class="btn" style="padding: 6px 10px; background: #f5f5f5; color: #333;" title="Xem chi tiết">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </td>
              </tr>
            `;
          });

          tableBody.innerHTML = html;
        }

        // Hàm render lịch sử thanh toán
        function renderHistoryPayments(payments) {
          const tableBody = document.getElementById("historyPaymentsTableBody");

          if (!tableBody) {
            console.error("Table body element not found!");
            return;
          }

          if (!payments || payments.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                  <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px; color: #2196f3;"></i>
                  <p>Không có dữ liệu lịch sử thanh toán.</p>
                </td>
              </tr>
            `;
            return;
          }

          let html = "";

          payments.forEach((payment) => {
            const formattedAmount = new Intl.NumberFormat("vi-VN", {
              style: "currency",
              currency: "VND",
            }).format(payment.actualAmount || payment.amount);
            const formattedDate = new Date(
              payment.paymentDate
            ).toLocaleDateString("vi-VN");

            html += `
              <tr style="border-bottom: 1px solid #f0f0f0; height: 50px; background: white;">
                <td style="padding: 12px 8px; text-align: center; font-weight: 500;">${
                  payment.id
                }</td>
                <td style="padding: 12px 8px; text-align: left;">${
                  payment.bookingId
                }</td>
                <td style="padding: 12px 8px; text-align: left;">${
                  payment.customerName
                }</td>
                <td style="padding: 12px 8px; text-align: center;">${formattedDate}</td>
                <td style="padding: 12px 8px; text-align: right;">${formattedAmount}</td>
                <td style="padding: 12px 8px; text-align: center;">${renderPaymentMethod(
                  payment.paymentMethod
                )}</td>
                <td style="padding: 12px 8px; text-align: center;">
                  <div style="display: flex; justify-content: center; gap: 5px;">
                    <button onclick="viewPaymentDetails('${
                      payment.id
                    }')" class="btn" style="padding: 6px 10px; background: #f5f5f5; color: #333;" title="Xem chi tiết">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </td>
              </tr>
            `;
          });

          tableBody.innerHTML = html;
        }

        // Hàm render phương thức thanh toán
        function renderPaymentMethod(method) {
          switch (method) {
            case "CASH":
              return '<span class="status-badge" style="background-color: rgba(76, 175, 80, 0.1); color: #4caf50;"><i class="fas fa-money-bill-wave"></i> Tiền mặt</span>';
            case "BANKING":
              return '<span class="status-badge" style="background-color: rgba(3, 169, 244, 0.1); color: #03a9f4;"><i class="fas fa-university"></i> Chuyển khoản</span>';
            case "COD":
              return '<span class="status-badge" style="background-color: rgba(255, 152, 0, 0.1); color: #ff9800;"><i class="fas fa-truck"></i> COD</span>';
            default:
              return '<span class="status-badge" style="background-color: rgba(158, 158, 158, 0.1); color: #9e9e9e;"><i class="fas fa-question-circle"></i> Khác</span>';
          }
        }

        // Hàm render trạng thái thanh toán
        function renderPaymentStatus(status) {
          switch (status) {
            case "PENDING":
              return '<span class="status-badge" style="background-color: rgba(255, 152, 0, 0.1); color: #ff9800;"><i class="fas fa-clock"></i> Chờ xử lý</span>';
            case "CONFIRMED":
              return '<span class="status-badge" style="background-color: rgba(76, 175, 80, 0.1); color: #4caf50;"><i class="fas fa-check-circle"></i> Đã xác nhận</span>';
            case "CANCELLED":
              return '<span class="status-badge" style="background-color: rgba(244, 67, 54, 0.1); color: #f44336;"><i class="fas fa-times-circle"></i> Đã hủy</span>';
            default:
              return '<span class="status-badge" style="background-color: rgba(158, 158, 158, 0.1); color: #9e9e9e;"><i class="fas fa-question-circle"></i> Không xác định</span>';
          }
        }

        // Hàm render phân trang cho thanh toán chờ xử lý
        function renderPendingPagination(currentPage, totalPages) {
          const paginationElement =
            document.getElementById("pendingPagination");

          if (!paginationElement) {
            console.error("Pagination element not found!");
            return;
          }

          if (totalPages <= 1) {
            paginationElement.innerHTML = "";
            return;
          }

          let html = `
            <div style="display: flex; gap: 5px; align-items: center;">
              <button 
                onclick="changePendingPage(${Math.max(0, currentPage - 1)})" 
                class="btn" 
                style="padding: 6px 12px; background: ${
                  currentPage === 0 ? "#f5f5f5" : "#e3f2fd"
                }; color: ${currentPage === 0 ? "#aaa" : "#2196f3"};"
                ${currentPage === 0 ? "disabled" : ""}
              >
                <i class="fas fa-chevron-left"></i>
              </button>
          `;

          const pageStart = Math.max(0, currentPage - 2);
          const pageEnd = Math.min(totalPages - 1, currentPage + 2);

          if (pageStart > 0) {
            html += `
              <button onclick="changePendingPage(0)" class="btn" style="padding: 6px 12px; background: #f5f5f5; color: #333;">1</button>
              ${pageStart > 1 ? '<span style="color: #666;">...</span>' : ""}
            `;
          }

          for (let i = pageStart; i <= pageEnd; i++) {
            html += `
              <button 
                onclick="changePendingPage(${i})" 
                class="btn" 
                style="padding: 6px 12px; background: ${
                  i === currentPage ? "#2196f3" : "#f5f5f5"
                }; color: ${i === currentPage ? "white" : "#333"};"
              >
                ${i + 1}
              </button>
            `;
          }

          if (pageEnd < totalPages - 1) {
            html += `
              ${
                pageEnd < totalPages - 2
                  ? '<span style="color: #666;">...</span>'
                  : ""
              }
              <button onclick="changePendingPage(${
                totalPages - 1
              })" class="btn" style="padding: 6px 12px; background: #f5f5f5; color: #333;">${totalPages}</button>
            `;
          }

          html += `
            <button 
              onclick="changePendingPage(${Math.min(
                totalPages - 1,
                currentPage + 1
              )})" 
              class="btn" 
              style="padding: 6px 12px; background: ${
                currentPage === totalPages - 1 ? "#f5f5f5" : "#e3f2fd"
              }; color: ${currentPage === totalPages - 1 ? "#aaa" : "#2196f3"};"
              ${currentPage === totalPages - 1 ? "disabled" : ""}
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          `;

          paginationElement.innerHTML = html;
        }

        // Hàm render phân trang cho lịch sử thanh toán
        function renderHistoryPagination(currentPage, totalPages) {
          const paginationElement =
            document.getElementById("historyPagination");

          if (!paginationElement) {
            console.error("Pagination element not found!");
            return;
          }

          if (totalPages <= 1) {
            paginationElement.innerHTML = "";
            return;
          }

          let html = `
            <div style="display: flex; gap: 5px; align-items: center;">
              <button 
                onclick="changeHistoryPage(${Math.max(0, currentPage - 1)})" 
                class="btn" 
                style="padding: 6px 12px; background: ${
                  currentPage === 0 ? "#f5f5f5" : "#e3f2fd"
                }; color: ${currentPage === 0 ? "#aaa" : "#2196f3"};"
                ${currentPage === 0 ? "disabled" : ""}
              >
                <i class="fas fa-chevron-left"></i>
              </button>
          `;

          const pageStart = Math.max(0, currentPage - 2);
          const pageEnd = Math.min(totalPages - 1, currentPage + 2);

          if (pageStart > 0) {
            html += `
              <button onclick="changeHistoryPage(0)" class="btn" style="padding: 6px 12px; background: #f5f5f5; color: #333;">1</button>
              ${pageStart > 1 ? '<span style="color: #666;">...</span>' : ""}
            `;
          }

          for (let i = pageStart; i <= pageEnd; i++) {
            html += `
              <button 
                onclick="changeHistoryPage(${i})" 
                class="btn" 
                style="padding: 6px 12px; background: ${
                  i === currentPage ? "#2196f3" : "#f5f5f5"
                }; color: ${i === currentPage ? "white" : "#333"};"
              >
                ${i + 1}
              </button>
            `;
          }

          if (pageEnd < totalPages - 1) {
            html += `
              ${
                pageEnd < totalPages - 2
                  ? '<span style="color: #666;">...</span>'
                  : ""
              }
              <button onclick="changeHistoryPage(${
                totalPages - 1
              })" class="btn" style="padding: 6px 12px; background: #f5f5f5; color: #333;">${totalPages}</button>
            `;
          }

          html += `
            <button 
              onclick="changeHistoryPage(${Math.min(
                totalPages - 1,
                currentPage + 1
              )})" 
              class="btn" 
              style="padding: 6px 12px; background: ${
                currentPage === totalPages - 1 ? "#f5f5f5" : "#e3f2fd"
              }; color: ${currentPage === totalPages - 1 ? "#aaa" : "#2196f3"};"
              ${currentPage === totalPages - 1 ? "disabled" : ""}
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          `;

          paginationElement.innerHTML = html;
        }

        // Hàm chuyển trang thanh toán chờ xử lý
        function changePendingPage(page) {
          fetchPendingPayments(page, pageSize, pendingFilters);
        }

        // Hàm chuyển trang lịch sử thanh toán
        function changeHistoryPage(page) {
          fetchHistoryPayments(page, pageSize, historyFilters);
        }

        // Xử lý form tìm kiếm thanh toán chờ xử lý
        document
          .getElementById("pendingFilterForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            pendingFilters = {
              searchQuery: document.getElementById("pendingSearchFilter").value,
            };

            fetchPendingPayments(0, pageSize, pendingFilters);
          });

        // Xử lý form tìm kiếm theo mã/tên của lịch sử thanh toán
        document
          .getElementById("historySearchForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            historyFilters.searchQuery = document.getElementById(
              "historySearchFilter"
            ).value;
            fetchHistoryPayments(0, pageSize, historyFilters);
          });

        // Xử lý form lọc lịch sử thanh toán
        document
          .getElementById("historyFilterForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            historyFilters = {
              searchQuery: document.getElementById("historySearchFilter").value,
              specificDate: document.getElementById("dateFilter").value,
              paymentMethod: document.getElementById("paymentMethodFilter")
                .value,
            };

            fetchHistoryPayments(0, pageSize, historyFilters);
          });

        // Hàm reset filter lịch sử thanh toán
        function resetHistoryFilter() {
          document.getElementById("historyFilterForm").reset();
          document.getElementById("historySearchForm").reset();

          historyFilters = {
            searchQuery: "",
            specificDate: "",
            paymentMethod: "",
          };

          fetchHistoryPayments(0, pageSize, historyFilters);
        }

        // Hàm xem biên lai chuyển khoản
        function viewReceipt(paymentId) {
          // Tìm thanh toán trong dữ liệu (cả chờ xử lý và lịch sử)
          let payment = pendingPayments.find((p) => p.id === paymentId);

          if (!payment) {
            // Tìm trong lịch sử thanh toán
            payment = historyPayments.find((p) => p.id === paymentId);
          }

          if (!payment) {
            alert("Không tìm thấy thông tin thanh toán!");
            return;
          }

          if (!payment.receiptUrl) {
            alert("Không có biên lai chuyển khoản cho thanh toán này!");
            return;
          }

          // Tạo modal hiển thị biên lai
          const modalId = "receipt-modal";
          createModal(modalId, "Biên lai chuyển khoản");

          const modalContainer = document.getElementById(modalId);
          const modalContent = modalContainer.querySelector(".modal-content");

          modalContent.innerHTML += `
            <div style="text-align: center; padding: 20px;">
              <div style="margin-bottom: 15px; color: #666;">
                <p>Mã thanh toán: <strong>${payment.id}</strong></p>
                <p>Khách hàng: <strong>${payment.customerName}</strong></p>
                <p>Số tiền: <strong>${new Intl.NumberFormat("vi-VN", {
                  style: "currency",
                  currency: "VND",
                }).format(payment.amount)}</strong></p>
              </div>
              <div style="border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #f9f9f9;">
                <img src="${
                  payment.receiptUrl
                }" alt="Biên lai chuyển khoản" style="max-width: 100%; max-height: 500px; border-radius: 5px;">
              </div>
            </div>
          `;
        }

        // Hàm xác nhận thanh toán
        function confirmPayment(paymentId) {
          // Tìm thanh toán trong dữ liệu
          const payment = pendingPayments.find((p) => p.id === paymentId);

          if (!payment) {
            alert("Không tìm thấy thông tin thanh toán!");
            return;
          }

          // Tạo modal xác nhận thanh toán
          const modalId = "confirm-payment-modal";
          createModal(modalId, "Xác nhận thanh toán");

          const modalContainer = document.getElementById(modalId);
          const modalContent = modalContainer.querySelector(".modal-content");

          const formattedAmount = new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
          }).format(payment.amount);

          modalContent.innerHTML += `
            <form id="confirm-payment-form" style="margin-top: 20px;">
              <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Mã thanh toán:</span>
                  <span style="font-weight: 600; color: #333;">${
                    payment.id
                  }</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Mã lịch hẹn:</span>
                  <span style="font-weight: 600; color: #333;">${
                    payment.bookingId
                  }</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Khách hàng:</span>
                  <span style="font-weight: 600; color: #333;">${
                    payment.customerName
                  }</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Số tiền thanh toán:</span>
                  <span style="font-weight: 600; color: #333;">${formattedAmount}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span style="font-weight: 500; color: #666;">Phương thức:</span>
                  <span style="font-weight: 600; color: #333;">${renderPaymentMethod(
                    payment.paymentMethod
                  )}</span>
                </div>
              </div>

              <div style="margin-bottom: 15px;">
                <label for="actual_amount" style="display: block; margin-bottom: 5px; font-weight: 500;">Số tiền thực tế (VNĐ):</label>
                <input type="number" id="actual_amount" name="actual_amount" value="${
                  payment.amount
                }" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
              </div>
              
              ${
                payment.paymentMethod === "BANKING"
                  ? `
              <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Biên lai chuyển khoản từ khách hàng:</label>
                <div style="border: 1px solid #ddd; padding: 15px; border-radius: 4px; text-align: center; background-color: #f9f9f9;">
                  ${
                    payment.receiptUrl
                      ? `<img src="${payment.receiptUrl}" alt="Biên lai chuyển khoản" style="max-width: 100%; max-height: 300px; border-radius: 4px;">
                     <p style="margin-top: 10px; color: #2196f3;"><i class="fas fa-check-circle"></i> Khách hàng đã gửi biên lai</p>`
                      : `<div style="padding: 30px 0;">
                       <i class="fas fa-exclamation-circle" style="font-size: 32px; color: #ff9800; margin-bottom: 10px;"></i>
                       <p style="color: #666;">Khách hàng chưa gửi biên lai chuyển khoản</p>
                     </div>`
                  }
                </div>
              </div>
              `
                  : ""
              }

              <div style="margin-bottom: 20px;">
                <label for="payment_notes" style="display: block; margin-bottom: 5px; font-weight: 500;">Ghi chú:</label>
                <textarea id="payment_notes" name="payment_notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">${
                  payment.notes || ""
                }</textarea>
              </div>

              <div style="text-align: right;">
                <button type="button" onclick="document.getElementById('${modalId}').remove()" class="btn" style="background: #f5f5f5; color: #333; border: none; margin-right: 10px;">Hủy</button>
                <button type="submit" class="btn btn-primary">Xác nhận thanh toán</button>
              </div>
            </form>
          `;

          // Không cần xử lý upload ảnh biên lai vì đã hiển thị biên lai từ khách hàng

          // Xử lý submit form
          document
            .getElementById("confirm-payment-form")
            .addEventListener("submit", function (e) {
              e.preventDefault();

              const actualAmount = parseFloat(
                document.getElementById("actual_amount").value
              );
              const notes = document.getElementById("payment_notes").value;

              // Không cần kiểm tra biên lai vì hiện đã hiển thị biên lai từ khách hàng

              // Trong chế độ demo, chỉ cập nhật dữ liệu local
              if (isDemoMode) {
                // Tìm và xóa thanh toán khỏi danh sách chờ xử lý
                const index = pendingPayments.findIndex(
                  (p) => p.id === paymentId
                );

                if (index !== -1) {
                  const confirmedPayment = pendingPayments[index];

                  // Cập nhật thông tin
                  confirmedPayment.status = "CONFIRMED";
                  confirmedPayment.actualAmount = actualAmount;
                  confirmedPayment.notes = notes;
                  confirmedPayment.paymentDate = new Date();

                  // Tiếp tục xử lý
                  // Xóa khỏi danh sách chờ và thêm vào lịch sử
                  pendingPayments.splice(index, 1);
                  historyPayments.unshift(confirmedPayment);

                  // Cập nhật giao diện
                  fetchPendingPayments(
                    currentPendingPage,
                    pageSize,
                    pendingFilters
                  );
                  showSuccessToast("Xác nhận thanh toán thành công!");
                }

                // Đóng modal
                document.getElementById(modalId).remove();
              } else {
                // Xử lý tích hợp API ở đây
                // ...
              }
            });
        }

        // Hàm xem chi tiết thanh toán
        function viewPaymentDetails(paymentId) {
          // Tìm thanh toán trong cả hai danh sách
          let payment = pendingPayments.find((p) => p.id === paymentId);

          if (!payment) {
            payment = historyPayments.find((p) => p.id === paymentId);
          }

          if (!payment) {
            alert("Không tìm thấy thông tin thanh toán!");
            return;
          }

          // Tạo modal chi tiết thanh toán
          const modalId = "payment-details-modal";
          createModal(modalId, "Chi tiết thanh toán");

          const modalContainer = document.getElementById(modalId);
          const modalContent = modalContainer.querySelector(".modal-content");

          const formattedAmount = new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
          }).format(payment.amount);
          const formattedActualAmount = payment.actualAmount
            ? new Intl.NumberFormat("vi-VN", {
                style: "currency",
                currency: "VND",
              }).format(payment.actualAmount)
            : "Chưa xác nhận";
          const formattedRequestDate = new Date(
            payment.requestDate
          ).toLocaleDateString("vi-VN");
          const formattedPaymentDate = payment.paymentDate
            ? new Date(payment.paymentDate).toLocaleDateString("vi-VN")
            : "Chưa thanh toán";

          modalContent.innerHTML += `
            <div style="padding: 20px;">
              <div style="background: #f5f5f5; border-radius: 5px; padding: 15px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Mã thanh toán:</span>
                  <span style="font-weight: 600; color: #333;">${
                    payment.id
                  }</span>
                </div>
              </div>
              
              <div style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; color: #2196f3; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Thông tin thanh toán</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Mã lịch hẹn:</p>
                    <p style="margin-top: 0; color: #333;">${
                      payment.bookingId
                    }</p>
                  </div>
                  
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Khách hàng:</p>
                    <p style="margin-top: 0; color: #333;">${
                      payment.customerName
                    }</p>
                  </div>
                  
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Phương thức thanh toán:</p>
                    <p style="margin-top: 0;">${renderPaymentMethod(
                      payment.paymentMethod
                    )}</p>
                  </div>
                  
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Ngày tạo:</p>
                    <p style="margin-top: 0; color: #333;">${formattedRequestDate}</p>
                  </div>
                  
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Ngày thanh toán:</p>
                    <p style="margin-top: 0; color: #333;">${formattedPaymentDate}</p>
                  </div>
                </div>
              </div>
              
              <div style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; color: #2196f3; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Thông tin số tiền</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Số tiền thanh toán:</p>
                    <p style="margin-top: 0; color: #333; font-weight: 600;">${formattedAmount}</p>
                  </div>
                  
                  <div>
                    <p style="font-weight: 500; color: #666; margin-bottom: 5px;">Số tiền thực tế:</p>
                    <p style="margin-top: 0; color: #333; font-weight: 600;">${formattedActualAmount}</p>
                  </div>
                </div>
              </div>
              
              ${
                payment.notes
                  ? `
              <div>
                <h3 style="font-size: 16px; color: #2196f3; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Ghi chú</h3>
                <p style="background: #f9f9f9; padding: 10px; border-radius: 5px; border: 1px solid #eee;">${payment.notes}</p>
              </div>
              `
                  : ""
              }
            </div>
          `;
        }

        // Hàm in biên lai
        function printReceipt(paymentId) {
          // Tìm thanh toán trong lịch sử
          const payment = historyPayments.find((p) => p.id === paymentId);

          if (!payment) {
            alert("Không tìm thấy thông tin thanh toán!");
            return;
          }

          if (payment.status !== "CONFIRMED") {
            alert("Chỉ có thể in biên lai cho thanh toán đã xác nhận!");
            return;
          }

          // Trong môi trường thực tế, sẽ gọi API để tạo và tải biên lai
          // Trong demo, chỉ hiển thị thông báo
          alert("Chức năng in biên lai sẽ được tích hợp với API thực tế!");
        }

        // Hàm mở modal thêm thanh toán mới
        function openAddPaymentModal() {
          // Tạo modal thêm thanh toán
          const modalId = "add-payment-modal";
          createModal(modalId, "Thêm thanh toán mới");

          const modalContainer = document.getElementById(modalId);
          const modalContent = modalContainer.querySelector(".modal-content");

          // Tạo dữ liệu demo cho booking chưa thanh toán
          const unpaidBookings = [
            {
              id: "AP001",
              customerName: "Nguyễn Văn A",
              amount: 5000000,
              paymentMethod: "CASH",
            },
            {
              id: "AP002",
              customerName: "Trần Thị B",
              amount: 3500000,
              paymentMethod: "BANKING",
            },
            {
              id: "AP003",
              customerName: "Lê Văn C",
              amount: 4200000,
              paymentMethod: "COD",
            },
            {
              id: "AP004",
              customerName: "Phạm Thị D",
              amount: 6500000,
              paymentMethod: "CASH",
            },
          ];

          // Lọc chỉ hiển thị các booking với phương thức thanh toán là CASH hoặc COD
          const filteredBookings = unpaidBookings.filter(
            (booking) =>
              booking.paymentMethod === "CASH" ||
              booking.paymentMethod === "COD"
          );

          // Render danh sách booking đã lọc
          let bookingOptions = "";
          filteredBookings.forEach((booking) => {
            const formattedAmount = new Intl.NumberFormat("vi-VN", {
              style: "currency",
              currency: "VND",
            }).format(booking.amount);
            bookingOptions += `<option value="${booking.id}" data-amount="${
              booking.amount
            }" data-customer="${booking.customerName}" data-payment-method="${
              booking.paymentMethod
            }">${booking.id} - ${booking.customerName} - ${formattedAmount} - ${
              booking.paymentMethod === "CASH" ? "Tiền mặt" : "COD"
            }</option>`;
          });

          modalContent.innerHTML += `
            <div style="margin-bottom: 20px;">
              <h3 style="font-size: 16px; color: #2196f3; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                Chọn lịch hẹn cần thêm thanh toán
              </h3>
              
              <div class="alert alert-info" style="background-color: #e1f5fe; color: #0288d1; padding: 16px 35px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #0288d1; font-size: 14px;">
                <i class="fas fa-exclamation-circle" style="margin-right: 10px;"></i>
                <strong>Lưu ý:</strong> Chỉ hiển thị các lịch hẹn với hình thức thanh toán COD hoặc Tiền mặt. Các lịch hẹn Chuyển khoản sẽ được hệ thống tự động cập nhật sau khi khách hàng chuyển khoản.
              </div>
              
              <select id="booking-select" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 20px;">
                <option value="" disabled selected>-- Chọn lịch hẹn --</option>
                ${bookingOptions}
              </select>
              
              <div id="booking-details" style="background: #f5f5f5; padding: 15px; border-radius: 5px; display: none;">
                <div style="margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Mã lịch hẹn:</span>
                  <span id="detail-booking-id" style="font-weight: 600; color: #333; margin-left: 10px;"></span>
                </div>
                <div style="margin-bottom: 10px;">
                  <span style="font-weight: 500; color: #666;">Khách hàng:</span>
                  <span id="detail-customer-name" style="font-weight: 600; color: #333; margin-left: 10px;"></span>
                </div>
                <div>
                  <span style="font-weight: 500; color: #666;">Số tiền:</span>
                  <span id="detail-amount" style="font-weight: 600; color: #333; margin-left: 10px;"></span>
                </div>
              </div>
            </div>
            
            <form id="add-payment-form" style="display: none;">
              <div style="margin-bottom: 15px;">
                <label for="payment_amount" style="display: block; margin-bottom: 5px; font-weight: 500;">Số tiền (VNĐ):</label>
                <input type="number" id="payment_amount" name="payment_amount" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
              </div>
              
              <div style="margin-bottom: 15px;">
                <label for="payment_method" style="display: block; margin-bottom: 5px; font-weight: 500;">Phương thức thanh toán:</label>
                <select id="payment_method" name="payment_method" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                  <option value="CASH">Tiền mặt</option>
                  <option value="COD">COD</option>
                </select>
              </div>
              
              <div style="margin-bottom: 20px;">
                <label for="payment_notes" style="display: block; margin-bottom: 5px; font-weight: 500;">Ghi chú:</label>
                <textarea id="payment_notes" name="payment_notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
              </div>
              
              <div style="text-align: right;">
                <button type="button" onclick="document.getElementById('${modalId}').remove()" class="btn" style="background: #f5f5f5; color: #333; border: none; margin-right: 10px;">Hủy</button>
                <button type="submit" class="btn btn-primary">Tạo thanh toán</button>
              </div>
            </form>
          `;

          // Xử lý chọn booking
          document
            .getElementById("booking-select")
            .addEventListener("change", function () {
              const selectedOption = this.options[this.selectedIndex];
              const bookingId = selectedOption.value;
              const customerName = selectedOption.dataset.customer;
              const amount = parseFloat(selectedOption.dataset.amount);
              const paymentMethod = selectedOption.dataset.paymentMethod;

              if (bookingId) {
                // Hiển thị chi tiết booking
                document.getElementById("detail-booking-id").textContent =
                  bookingId;
                document.getElementById("detail-customer-name").textContent =
                  customerName;
                document.getElementById("detail-amount").textContent =
                  new Intl.NumberFormat("vi-VN", {
                    style: "currency",
                    currency: "VND",
                  }).format(amount);

                document.getElementById("booking-details").style.display =
                  "block";
                document.getElementById("add-payment-form").style.display =
                  "block";

                // Tự động chọn phương thức thanh toán dựa trên phương thức của booking
                document.getElementById("payment_method").value = paymentMethod;

                // Cập nhật giá trị mặc định cho form
                document.getElementById("payment_amount").value = amount;
              } else {
                document.getElementById("booking-details").style.display =
                  "none";
                document.getElementById("add-payment-form").style.display =
                  "none";
              }
            });

          // Xử lý submit form
          document
            .getElementById("add-payment-form")
            .addEventListener("submit", function (e) {
              e.preventDefault();

              const bookingSelect = document.getElementById("booking-select");
              const selectedOption =
                bookingSelect.options[bookingSelect.selectedIndex];

              if (!selectedOption.value) {
                alert("Vui lòng chọn lịch hẹn!");
                return;
              }

              const bookingId = selectedOption.value;
              const customerName = selectedOption.dataset.customer;
              const amount = parseFloat(
                document.getElementById("payment_amount").value
              );
              const paymentMethod =
                document.getElementById("payment_method").value;
              const notes = document.getElementById("payment_notes").value;

              // Trong chế độ demo, chỉ thêm vào dữ liệu local
              if (isDemoMode) {
                // Tạo mã thanh toán mới
                const paymentId =
                  "PAY" +
                  String(
                    pendingPayments.length + historyPayments.length + 1
                  ).padStart(3, "0");

                // Tạo thanh toán mới
                const newPayment = {
                  id: paymentId,
                  bookingId: bookingId,
                  customerName: customerName,
                  requestDate: new Date(),
                  amount: amount,
                  paymentMethod: paymentMethod,
                  status: "PENDING",
                  receiptUrl:
                    paymentMethod === "BANKING"
                      ? "/assets/images/receipt-sample.jpg"
                      : "",
                  actualAmount: 0,
                  notes: notes,
                };

                // Thêm vào danh sách chờ xử lý
                pendingPayments.unshift(newPayment);

                // Cập nhật giao diện
                fetchPendingPayments(0, pageSize, pendingFilters);
                showSuccessToast("Tạo thanh toán mới thành công!");
              } else {
                // Xử lý tích hợp API ở đây
                // ...
              }

              // Đóng modal
              document.getElementById(modalId).remove();
            });
        }

        // Hàm tạo modal chung
        function createModal(modalId, title) {
          // Kiểm tra nếu đã tồn tại, xóa modal cũ
          const existingModal = document.getElementById(modalId);
          if (existingModal) {
            existingModal.remove();
          }

          // Tạo modal mới
          const modalContainer = document.createElement("div");
          modalContainer.id = modalId;
          modalContainer.className = "modal-container";
          modalContainer.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
          `;

          modalContainer.innerHTML = `
            <div class="modal-content" style="
              background-color: white;
              border-radius: 8px;
              max-width: 600px;
              width: 95%;
              max-height: 90vh;
              overflow-y: auto;
              box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
              padding: 10px;
            ">
              <div style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px 20px;
                border-bottom: 1px solid #eee;
              ">
                <h3 style="margin: 0; font-size: 18px; color: #2196f3;">${title}</h3>
                <button onclick="document.getElementById('${modalId}').remove()" style="
                  background: none;
                  border: none;
                  font-size: 20px;
                  cursor: pointer;
                  color: #666;
                ">&times;</button>
              </div>
            </div>
          `;

          document.body.appendChild(modalContainer);
          return modalContainer;
        }

        // Hiển thị thông báo thành công
        function showSuccessToast(message) {
          const toast = document.createElement("div");
          toast.className = "toast-notification";
          toast.innerHTML = `
            <div class="toast-content">
              <i class="fas fa-check-circle" style="color: #4caf50; margin-right: 8px;"></i>
              ${message}
            </div>
          `;
          document.body.appendChild(toast);

          // Tự động ẩn toast sau 3 giây
          setTimeout(() => {
            toast.style.opacity = "0";
            setTimeout(() => toast.remove(), 300);
          }, 3000);
        }

        // Render mặc định khi load trang
        document.addEventListener("DOMContentLoaded", function () {
          // Kiểm tra đăng nhập và hiển thị nội dung tương ứng
          checkAuthentication().then((auth) => {
            if (auth) {
              document.getElementById(
                "payment-content-container"
              ).style.display = "block";
              document.getElementById("login-required-message").style.display =
                "none";
              fetchPendingPayments();
            } else {
              document.getElementById(
                "payment-content-container"
              ).style.display = "none";
              document.getElementById("login-required-message").style.display =
                "block";
            }
          });
        });
      </script>

      <!-- Include the auth and API JS files -->
      <script src="/assets/js/staff-api.js"></script>
      <script src="/assets/js/staff-auth.js"></script>
      <script src="/assets/js/staff-main.js"></script>
    </div>
  </body>
</html>
